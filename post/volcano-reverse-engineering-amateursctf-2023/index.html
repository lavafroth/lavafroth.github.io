<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Volcano - Reverse Engineering Challenge | AmateursCTF 2023 - lavafroth</title><meta name=description content="This reversing challenge is very mathematical, focusing mainly on modulo congruences. Like all challenges, there is some scary looking obfuscation for the fun which I&rsquo;ll try my best to explain. The challenge description says that it was inspired by recent &ldquo;traumatic&rdquo; events but I&rsquo;m oblivious to what that reference meant.
Decompilation We start off with downloading the binary and opening it in Ghidra.
In the list of functions under the Symbol Tree, we can navigate to the entry function which looks like:"><meta name=author content="Himadri Bhattacharjee"><link rel="preload stylesheet" as=style href=https://lavafroth.is-a.dev/app.min.css><link rel=preload as=image href=https://lavafroth.is-a.dev/theme.png><link rel=preload as=image href=https://lavafroth.is-a.dev/github.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/about.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/art.svg><link rel=icon href=https://lavafroth.is-a.dev/favicon.ico><link rel=blog-icon href=https://lavafroth.is-a.dev/icon.png></head><body class=not-ready data-menu=true><header class=header><div class=lava><div class=logo><h1><a class=site-name href=https://lavafroth.is-a.dev/>lavafroth</a></h1><svg class="btn-dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 60 60" preserveAspectRatio="xMinYMin meet"><path class="circle" d="M30 16c7.73.0 14 6.27 14 14 0 3.81-1.53 7.27-4 9.8-2.54 2.59-6.08 4.2-10 4.2-7.73.0-14-6.27-14-14 0-7.73 6.27-14 14-14z"/><g class="rays" data-svg-origin="30 30"><line class="line" x1="30" y1="11" x2="30" y2="7"/><line class="line" x1="43.44" y1="16.57" x2="46.26" y2="13.74"/><line class="line" x1="49" y1="30" x2="53" y2="30"/><line class="line" x1="43.43" y1="43.44" x2="46.26" y2="46.26"/><line class="line" x1="30" y1="49" x2="30" y2="53"/><line class="line" x1="16.56" y1="43.43" x2="13.74" y2="46.26"/><line class="line" x1="11" y1="30" x2="7" y2="30"/><line class="line" x1="16.57" y1="16.56" x2="13.74" y2="13.74"/></g></svg><nav class=social><a class=github style=--url:url(./github.svg) href=https://github.com/lavafroth target=_blank></a>
<a href=../../about/ title style=--url:url(./about.svg)></a>
<a href=../../art/ title style=--url:url(./art.svg)></a></nav><script>const bodyClx=document.body.classList,btnDark=document.querySelector(".btn-dark"),sysDark=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark"),setDark=e=>(bodyClx.toggle("dark",e),localStorage.setItem("dark",e));setDark(darkVal==="true"||sysDark.matches),requestAnimationFrame(()=>bodyClx.remove("not-ready")),btnDark.addEventListener("click",()=>setDark(!bodyClx.contains("dark"))),sysDark.addEventListener("change",({matches:e})=>setDark(e))</script></div><div class=bubbles><div class=bubble style=--size:3.1573520635288297rem;--distance:9.777460616790547rem;--position:79.82351594640258%;--time:2.119561966408366s;--delay:-2.511069904370182s></div><div class=bubble style=--size:5.464382923434847rem;--distance:8.202204257500235rem;--position:73.05291394812365%;--time:2.8163650791714443s;--delay:-2.10834069552337s></div><div class=bubble style=--size:5.54171635032949rem;--distance:7.21628154079756rem;--position:3.5185273501097587%;--time:3.315974703485457s;--delay:-3.990557496815194s></div><div class=bubble style=--size:5.0780408722783115rem;--distance:7.9062882665654115rem;--position:96.75584737203708%;--time:2.9935278687454545s;--delay:-3.4097998510686813s></div><div class=bubble style=--size:2.451790257749897rem;--distance:9.375064105953562rem;--position:28.633085440410255%;--time:2.692548467667867s;--delay:-2.555074529650302s></div><div class=bubble style=--size:5.585816850593148rem;--distance:6.9600422960042865rem;--position:72.51244146669855%;--time:3.483246137208243s;--delay:-3.326136738066893s></div><div class=bubble style=--size:2.7392297893119135rem;--distance:8.030468953788962rem;--position:8.86445777813215%;--time:2.889575913936971s;--delay:-2.146827283616331s></div><div class=bubble style=--size:4.171962693508177rem;--distance:7.211002745280388rem;--position:58.2711084896879%;--time:2.716958408694885s;--delay:-3.296786648250234s></div><div class=bubble style=--size:4.532330684666543rem;--distance:8.578254049517938rem;--position:0.565927638475408%;--time:2.2846750146942254s;--delay:-3.4959322437591482s></div><div class=bubble style=--size:4.556463823827298rem;--distance:7.094090631014913rem;--position:70.39822723543791%;--time:3.624537503862896s;--delay:-2.857420933636443s></div><div class=bubble style=--size:5.07603378328206rem;--distance:6.645037412951618rem;--position:8.652005686621889%;--time:2.698244199090787s;--delay:-2.527616744094707s></div><div class=bubble style=--size:3.118201429900723rem;--distance:8.143294120584633rem;--position:64.35281134429346%;--time:2.2798669446425186s;--delay:-2.1420127307963344s></div><div class=bubble style=--size:3.418153008888427rem;--distance:9.064629817008509rem;--position:52.44283935234534%;--time:3.5827037199475575s;--delay:-2.995911643153717s></div><div class=bubble style=--size:2.191671240434883rem;--distance:8.944809822901478rem;--position:49.096851163552614%;--time:2.6651233627364372s;--delay:-3.300002230918009s></div><div class=bubble style=--size:3.369853326930267rem;--distance:6.331290194753575rem;--position:104.21704424457798%;--time:3.8955228568460027s;--delay:-3.4855417485078464s></div><div class=bubble style=--size:5.5113557063736245rem;--distance:8.568147573044554rem;--position:98.2498321096982%;--time:3.278666488584876s;--delay:-2.3468950982430616s></div><div class=bubble style=--size:5.672304818021649rem;--distance:9.782337765105405rem;--position:32.67241762023444%;--time:2.2703169650802293s;--delay:-3.9645713700523983s></div><div class=bubble style=--size:3.9388421289276483rem;--distance:7.218402286241155rem;--position:25.252599878511358%;--time:3.061152350442821s;--delay:-2.0708403071805406s></div><div class=bubble style=--size:2.206141240805235rem;--distance:7.760669925358866rem;--position:1.4597033545946854%;--time:3.969581249858505s;--delay:-2.2487091839080553s></div><div class=bubble style=--size:2.589806449494878rem;--distance:6.079178451528124rem;--position:56.42959891728088%;--time:2.9194662555481306s;--delay:-2.515893631902179s></div><div class=bubble style=--size:4.916044498049767rem;--distance:6.8458708795549095rem;--position:52.90949158878315%;--time:2.5752577719013083s;--delay:-3.6656718499279526s></div><div class=bubble style=--size:4.710265252521078rem;--distance:9.065982215990093rem;--position:62.232586785691396%;--time:3.63261593199919s;--delay:-2.0799296560779794s></div><div class=bubble style=--size:4.80868502150219rem;--distance:9.31843825728931rem;--position:52.33077257309814%;--time:3.1052043107141287s;--delay:-2.1829374129358485s></div><div class=bubble style=--size:4.60673963425293rem;--distance:8.84329033694339rem;--position:4.61870339863248%;--time:3.5258904404870326s;--delay:-3.7259085270061183s></div><div class=bubble style=--size:2.30776598310732rem;--distance:9.34563069282983rem;--position:86.81246243436092%;--time:3.3785018210778133s;--delay:-3.8884245347339097s></div><div class=bubble style=--size:3.771325201902952rem;--distance:7.537743036639792rem;--position:99.83782131571066%;--time:2.9795293630719635s;--delay:-2.0440255508279725s></div><div class=bubble style=--size:3.515905905101607rem;--distance:9.123800105025058rem;--position:52.27887455419%;--time:2.4743305426931745s;--delay:-2.1668790994717293s></div><div class=bubble style=--size:3.349975346700309rem;--distance:6.099525580933591rem;--position:86.19226178189942%;--time:3.73351241604457s;--delay:-3.7277466742109526s></div><div class=bubble style=--size:2.594203315627623rem;--distance:9.481507372000836rem;--position:48.478568433922725%;--time:2.001355560993734s;--delay:-2.873348731141025s></div><div class=bubble style=--size:4.208475535168454rem;--distance:7.949479398044607rem;--position:15.12817215146464%;--time:2.8775747141619057s;--delay:-2.44697699668547s></div><div class=bubble style=--size:4.808679093865685rem;--distance:8.35512071159537rem;--position:20.77592767701002%;--time:2.2941807591177183s;--delay:-2.0117738543581565s></div><div class=bubble style=--size:2.9094100558844787rem;--distance:8.658895286915223rem;--position:75.01431085194308%;--time:3.337416107927284s;--delay:-2.329229409935038s></div><div class=bubble style=--size:4.916550270723802rem;--distance:8.991371244178316rem;--position:88.16428124678242%;--time:3.543887527881868s;--delay:-3.117597716172686s></div><div class=bubble style=--size:4.183719518254308rem;--distance:6.036664021374489rem;--position:5.242327215616964%;--time:3.680410804784464s;--delay:-2.1979710698033066s></div><div class=bubble style=--size:2.195201281915745rem;--distance:7.54167483656756rem;--position:100.82583136288696%;--time:2.136409883934854s;--delay:-3.989942097610389s></div><div class=bubble style=--size:2.372472748316257rem;--distance:8.971269770130899rem;--position:35.22138774545767%;--time:3.504781994206962s;--delay:-3.569878419825069s></div><div class=bubble style=--size:4.1960151286835945rem;--distance:6.1215578387345095rem;--position:46.31269673675248%;--time:3.4151434354130674s;--delay:-2.387604702108186s></div><div class=bubble style=--size:2.196732774678229rem;--distance:8.804848936451702rem;--position:45.39987050964828%;--time:3.316683633487673s;--delay:-3.1981971902884685s></div><div class=bubble style=--size:2.0529976835521486rem;--distance:8.600957982798818rem;--position:41.37759553673493%;--time:3.2740925387984974s;--delay:-3.905976112047844s></div><div class=bubble style=--size:5.376914279513754rem;--distance:7.407085630853494rem;--position:63.24201611997715%;--time:2.1264285640291862s;--delay:-3.051025398511498s></div><div class=bubble style=--size:3.7450799812351994rem;--distance:9.27365599692357rem;--position:59.16835173165882%;--time:2.219333023219039s;--delay:-3.316382525233861s></div><div class=bubble style=--size:4.786605846571324rem;--distance:7.578229664193804rem;--position:60.6427424182681%;--time:2.8273438402809394s;--delay:-3.455732177447113s></div><div class=bubble style=--size:2.938278644808678rem;--distance:9.938293208055786rem;--position:76.67119791168354%;--time:2.103244616802722s;--delay:-3.9704952976762997s></div><div class=bubble style=--size:5.012613389182628rem;--distance:9.810547260738733rem;--position:19.822190366974635%;--time:2.0906950847679164s;--delay:-3.778541998909121s></div><div class=bubble style=--size:2.352723596034365rem;--distance:8.397253238309649rem;--position:-2.3316241256657855%;--time:3.518616763158588s;--delay:-2.7090310143181644s></div><div class=bubble style=--size:2.560757032134992rem;--distance:7.465288707793678rem;--position:59.52289816263949%;--time:2.3372893042504406s;--delay:-2.6207518451312732s></div><div class=bubble style=--size:5.764928617835869rem;--distance:7.038862224644299rem;--position:16.721242071278617%;--time:2.141182276317782s;--delay:-2.8786872186742465s></div><div class=bubble style=--size:5.822991651957761rem;--distance:8.095925336593208rem;--position:43.22787179511871%;--time:2.8490098963477255s;--delay:-2.7222347863832947s></div><div class=bubble style=--size:4.690866285770111rem;--distance:9.582968751042802rem;--position:9.034439977199735%;--time:3.1395412275822516s;--delay:-2.746787293711964s></div><div class=bubble style=--size:3.40545539505801rem;--distance:8.669729554506162rem;--position:-3.321193044421753%;--time:3.24881749500489s;--delay:-2.174245724907715s></div><div class=bubble style=--size:2.172294383071536rem;--distance:7.627910355839513rem;--position:92.16608231592369%;--time:2.047980200652401s;--delay:-3.862421045452209s></div><div class=bubble style=--size:2.425515628392274rem;--distance:7.609422479470836rem;--position:97.54851972848475%;--time:2.5336071978279824s;--delay:-2.9319860615603712s></div><div class=bubble style=--size:4.777143245059128rem;--distance:6.443914820662836rem;--position:90.52922244564954%;--time:3.3213063283891793s;--delay:-3.8505805988603834s></div><div class=bubble style=--size:3.072189810464895rem;--distance:7.263219342754864rem;--position:8.283420371048717%;--time:3.699352106176918s;--delay:-2.9613689746478737s></div><div class=bubble style=--size:4.228476129628428rem;--distance:6.36981004892698rem;--position:36.436296361102784%;--time:3.327948300393536s;--delay:-2.7019225510747096s></div><div class=bubble style=--size:4.745380579657766rem;--distance:6.655268131779713rem;--position:46.237833943953405%;--time:3.4810790747966522s;--delay:-3.440845596373659s></div><div class=bubble style=--size:2.492986251507652rem;--distance:8.850291761655484rem;--position:38.54527449053424%;--time:3.9459534084061887s;--delay:-3.2609494301905166s></div><div class=bubble style=--size:5.852520791787054rem;--distance:8.611646147069422rem;--position:-2.112337659082899%;--time:2.323082097601607s;--delay:-3.4305342668413266s></div><div class=bubble style=--size:4.712295628789016rem;--distance:7.608690016853551rem;--position:-0.70572452280945%;--time:2.5965373845022657s;--delay:-3.7992221451492902s></div><div class=bubble style=--size:2.9051516428147313rem;--distance:7.402827513210772rem;--position:23.977327965505314%;--time:3.9382729257289633s;--delay:-2.9478878399723887s></div><div class=bubble style=--size:5.37854688142705rem;--distance:8.550119881249136rem;--position:54.19156364567646%;--time:3.7770680873747033s;--delay:-3.5196870939784084s></div><div class=bubble style=--size:3.527712941562201rem;--distance:6.062329591706292rem;--position:-2.89796421492563%;--time:2.238022589528245s;--delay:-3.147375710595563s></div><div class=bubble style=--size:3.200640083274175rem;--distance:7.859513120786255rem;--position:13.747596391489125%;--time:3.387430173535349s;--delay:-2.508616413150541s></div><div class=bubble style=--size:2.163960447441803rem;--distance:8.778841962547915rem;--position:95.94500362059767%;--time:2.660417809838789s;--delay:-3.6130288690993306s></div><div class=bubble style=--size:3.156951339828767rem;--distance:9.956599461412498rem;--position:48.71783219463389%;--time:2.0794702862063223s;--delay:-3.998680242326202s></div><div class=bubble style=--size:3.7964213024842985rem;--distance:8.396204509710422rem;--position:72.59901296142988%;--time:2.7736924428434513s;--delay:-3.4193337878555097s></div><div class=bubble style=--size:5.15366941586544rem;--distance:7.442379170996494rem;--position:100.42443025305154%;--time:3.9160173799259588s;--delay:-2.5350633304517403s></div><div class=bubble style=--size:2.379578429213379rem;--distance:6.75740977433995rem;--position:6.071825202433391%;--time:2.7409259000987523s;--delay:-3.061518371851812s></div><div class=bubble style=--size:2.7161326200879365rem;--distance:7.443012696347425rem;--position:94.54154664489576%;--time:2.252009059953056s;--delay:-2.850428025421688s></div><div class=bubble style=--size:5.338213729194962rem;--distance:7.8296097748068245rem;--position:104.31815394727944%;--time:2.5181076015598363s;--delay:-2.792889558963517s></div><div class=bubble style=--size:4.677613519962753rem;--distance:7.547053659581501rem;--position:62.79503545575673%;--time:3.9798958335619075s;--delay:-2.642889547046062s></div><div class=bubble style=--size:4.600841539587519rem;--distance:7.111264085633966rem;--position:32.93333286860395%;--time:2.0995891279538843s;--delay:-2.82337099091355s></div><div class=bubble style=--size:4.937156614156352rem;--distance:8.141423872810948rem;--position:64.76377512989443%;--time:3.878011907641161s;--delay:-2.0776515861838476s></div><div class=bubble style=--size:5.464209147082656rem;--distance:6.16168015844219rem;--position:81.9093862477641%;--time:2.36096642742533s;--delay:-3.201129315223698s></div><div class=bubble style=--size:3.0638718374292786rem;--distance:8.339518681300468rem;--position:40.561492517815786%;--time:3.971239093589107s;--delay:-3.3289101684961806s></div><div class=bubble style=--size:3.7095814852639535rem;--distance:8.669471468140257rem;--position:34.09311265803539%;--time:2.430594868258288s;--delay:-3.287405916659933s></div><div class=bubble style=--size:2.9258659641866rem;--distance:8.87926442884251rem;--position:50.58373940219579%;--time:3.4807962221846354s;--delay:-3.59856198756007s></div><div class=bubble style=--size:2.066940049404841rem;--distance:8.748804284675305rem;--position:96.8971395843717%;--time:2.7453570642388048s;--delay:-3.0433424038921815s></div><div class=bubble style=--size:5.327630546150689rem;--distance:7.3836875147364625rem;--position:65.80986112208456%;--time:2.164964416386732s;--delay:-3.136378080242951s></div><div class=bubble style=--size:3.9306688638454874rem;--distance:9.944216015487171rem;--position:16.696802138049012%;--time:3.2471910283896617s;--delay:-2.798464726573834s></div><div class=bubble style=--size:2.0191221100891443rem;--distance:7.599369051527898rem;--position:68.0759833194086%;--time:3.78513125348422s;--delay:-2.731704015074298s></div><div class=bubble style=--size:4.709476032752907rem;--distance:8.592300096819226rem;--position:101.56836072747207%;--time:3.357821688195889s;--delay:-3.464741213898109s></div><div class=bubble style=--size:3.3015552870719986rem;--distance:8.186281390229443rem;--position:76.91449568684521%;--time:2.239942114775954s;--delay:-3.8058407969687678s></div><div class=bubble style=--size:2.3303913710914212rem;--distance:7.798936130721566rem;--position:17.863987177199412%;--time:2.569608702313029s;--delay:-2.6784270210611973s></div><div class=bubble style=--size:5.554787154774565rem;--distance:8.592136414160255rem;--position:89.18111414761651%;--time:2.8800003662802327s;--delay:-2.2567149506099313s></div><div class=bubble style=--size:2.874849035422754rem;--distance:9.102583798938209rem;--position:87.9256543749225%;--time:2.2168054627967226s;--delay:-3.805079017356886s></div><div class=bubble style=--size:4.472091382328382rem;--distance:9.004045355075995rem;--position:4.854675674342824%;--time:3.8531075079215604s;--delay:-2.79800835062909s></div><div class=bubble style=--size:3.5726260835226924rem;--distance:8.477994255893933rem;--position:72.46149584193786%;--time:3.979622326518513s;--delay:-2.061230017760451s></div><div class=bubble style=--size:4.163706989554627rem;--distance:9.47489849437773rem;--position:13.871782420024594%;--time:2.3515400527428927s;--delay:-2.0995962728471347s></div><div class=bubble style=--size:5.548356420073219rem;--distance:8.892675084107134rem;--position:46.11933460856142%;--time:3.545334586973909s;--delay:-3.3801543745894644s></div><div class=bubble style=--size:4.39219185055803rem;--distance:7.933095131117099rem;--position:47.221752007803346%;--time:2.366338056378407s;--delay:-2.4633871132846257s></div><div class=bubble style=--size:4.869873825638225rem;--distance:6.602238972606432rem;--position:8.008413506612953%;--time:2.2417693494331896s;--delay:-2.653305108946213s></div><div class=bubble style=--size:2.609803871778203rem;--distance:6.465015130775617rem;--position:98.45267853838197%;--time:3.2582634203691807s;--delay:-2.5469765884864146s></div><div class=bubble style=--size:3.692170879348117rem;--distance:6.148846216102932rem;--position:42.598683207916814%;--time:3.590027493217046s;--delay:-2.458627372938123s></div><div class=bubble style=--size:3.13371931340167rem;--distance:8.629774977369975rem;--position:8.26584091101138%;--time:3.4632516036299292s;--delay:-2.4428047213945976s></div><div class=bubble style=--size:5.3337351507338rem;--distance:9.514150167012112rem;--position:82.45272269713838%;--time:2.3798811696416964s;--delay:-2.7840053134258858s></div><div class=bubble style=--size:4.9046296721854405rem;--distance:8.604974499035588rem;--position:59.283370927934484%;--time:2.8248091589138493s;--delay:-3.5693285957321708s></div><div class=bubble style=--size:2.6672752126499217rem;--distance:8.387208213353594rem;--position:13.267155378078542%;--time:3.7363103446115558s;--delay:-2.910351872656129s></div><div class=bubble style=--size:2.2051971696247907rem;--distance:7.2819438794174625rem;--position:27.976116944859648%;--time:3.350821422712959s;--delay:-3.547854220935776s></div><div class=bubble style=--size:5.428924414714262rem;--distance:6.583819493754497rem;--position:99.8398036887203%;--time:2.4936663895530957s;--delay:-2.1438767599437383s></div><div class=bubble style=--size:2.0230413305356647rem;--distance:9.43453826170662rem;--position:12.213961398059165%;--time:3.0772160237064186s;--delay:-3.0795424392120987s></div><div class=bubble style=--size:2.063930526108078rem;--distance:9.558462346937564rem;--position:68.07796995584836%;--time:3.56929838791893s;--delay:-3.824027429996162s></div><div class=bubble style=--size:3.257099363627222rem;--distance:6.621327219169994rem;--position:92.33362842888727%;--time:2.0517956650841005s;--delay:-3.4422427087546907s></div><div class=bubble style=--size:2.1171301477954065rem;--distance:9.719096813129642rem;--position:70.08436689879504%;--time:3.7384308858183797s;--delay:-3.0706710752075197s></div><div class=bubble style=--size:5.112779410037207rem;--distance:7.695429389814016rem;--position:-2.14966602682227%;--time:3.57642299707581s;--delay:-2.4034192878360265s></div><div class=bubble style=--size:5.162675470130112rem;--distance:9.212118723148667rem;--position:3.0984197952934505%;--time:3.2589513048824457s;--delay:-2.5093381281915423s></div><div class=bubble style=--size:2.7246674568463787rem;--distance:9.12745268544741rem;--position:49.120294680111435%;--time:3.1762564511300977s;--delay:-3.832886220770901s></div><div class=bubble style=--size:5.349026043476247rem;--distance:8.790374067372515rem;--position:54.54843430655645%;--time:2.0700772264716036s;--delay:-3.975720761844946s></div><div class=bubble style=--size:5.127729051171082rem;--distance:6.142194386232878rem;--position:71.97016585088087%;--time:2.312705653014668s;--delay:-2.350598744844194s></div><div class=bubble style=--size:2.0201015578317145rem;--distance:9.75675051990936rem;--position:8.020062789238711%;--time:3.0732904442207842s;--delay:-3.4598954151773706s></div><div class=bubble style=--size:2.9164605310296974rem;--distance:8.41873984544106rem;--position:51.612260976605086%;--time:2.142616282498704s;--delay:-2.3847920007587478s></div><div class=bubble style=--size:3.5032717049186415rem;--distance:6.582979418765931rem;--position:-3.076434382195019%;--time:3.874670459658509s;--delay:-2.515671411117263s></div><div class=bubble style=--size:2.141933748277137rem;--distance:8.59581371621693rem;--position:33.93429226358781%;--time:3.6454031897063164s;--delay:-2.7940742798554132s></div><div class=bubble style=--size:3.345442714426433rem;--distance:9.044260951535312rem;--position:-4.650294346217494%;--time:2.0736419664755537s;--delay:-2.778792241654439s></div><div class=bubble style=--size:2.1263129168062553rem;--distance:7.3913517942503875rem;--position:31.45504027436062%;--time:2.4466944233932817s;--delay:-3.7532376177265623s></div><div class=bubble style=--size:5.241379779224864rem;--distance:6.259437679330544rem;--position:102.1413894444833%;--time:3.8907656928301555s;--delay:-3.3447980056450124s></div><div class=bubble style=--size:2.331998964957984rem;--distance:9.094390629027135rem;--position:-2.6908383211867837%;--time:2.8453745091133786s;--delay:-3.198027357641816s></div><div class=bubble style=--size:3.8204190766849466rem;--distance:6.442443820718948rem;--position:12.413067933385648%;--time:2.7830902741696306s;--delay:-3.1672753932191284s></div><div class=bubble style=--size:4.529982717229779rem;--distance:9.37007755632819rem;--position:100.37896472152282%;--time:2.569522003146849s;--delay:-2.2551840817951367s></div><div class=bubble style=--size:5.92838696231237rem;--distance:6.7301106256864545rem;--position:32.34812216630464%;--time:3.9023927560222624s;--delay:-2.255056982682299s></div><div class=bubble style=--size:4.699351072125338rem;--distance:6.766442174868489rem;--position:16.470785618032696%;--time:2.9972294563183746s;--delay:-2.3732040837342128s></div><div class=bubble style=--size:4.249420105641767rem;--distance:9.041961853600057rem;--position:38.606346517159736%;--time:2.373142369175816s;--delay:-2.6151599921478534s></div><div class=bubble style=--size:2.344663842468246rem;--distance:7.759965494391591rem;--position:65.474437910675%;--time:3.971142330142072s;--delay:-3.229227249606911s></div><div class=bubble style=--size:2.422280062220338rem;--distance:7.543330618328514rem;--position:81.87537876523214%;--time:2.3733202285494865s;--delay:-2.924996274989179s></div><div class=bubble style=--size:2.0125967736893333rem;--distance:9.770773664089738rem;--position:64.36956820131321%;--time:2.210066626569258s;--delay:-2.2942771000992472s></div><div class=bubble style=--size:4.566565802402101rem;--distance:6.704230153890237rem;--position:62.113076351236%;--time:2.5804502921480745s;--delay:-3.529413243520293s></div><div class=bubble style=--size:2.910533286234803rem;--distance:8.80350651389128rem;--position:59.47561542831464%;--time:3.433471577337245s;--delay:-3.491075664457081s></div><div class=bubble style=--size:2.5176134863940742rem;--distance:9.543890232600983rem;--position:2.633638418719375%;--time:3.9236323881961654s;--delay:-2.8545051911876764s></div><div class=lavasource></div></div><svg><defs><filter id="blob"><feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur"/><feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 19 -9" result="blob"/></filter></defs></svg></div></header><main class=main><article class=post-single><header class=post-title><p><time>Jul 21, 2023 | 12 minutes read</time></p><h1>Volcano - Reverse Engineering Challenge | AmateursCTF 2023</h1></header><section class=post-content><p>This reversing challenge is very mathematical, focusing mainly on modulo congruences.
Like all challenges, there is some scary looking obfuscation for the fun which I&rsquo;ll try my best to
explain. The challenge description says that it was <em>inspired by recent &ldquo;traumatic&rdquo; events</em> but I&rsquo;m oblivious to what that
reference meant.</p><h2 id=decompilation>Decompilation</h2><p>We start off with downloading the binary and opening it in Ghidra.</p><p>In the list of functions under the Symbol Tree, we can navigate to the <code>entry</code> function which looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>void</span> processEntry <span style=color:#a6e22e>entry</span>(undefined8 param_1,undefined8 param_2)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  undefined auStack_8 [<span style=color:#ae81ff>8</span>];
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>__libc_start_main</span>(FUN_001014a7,param_2,<span style=color:#f92672>&amp;</span>stack0x00000008,FUN_00101760,FUN_001017d0,param_1,auStack_8);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>/* WARNING: Do nothing block with infinite loop */</span>
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>while</span>( true );
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Notice the call to <code>__libc_start_main</code>, the first argument supplied is a function pointer which points to the main function.</p><p>I have a habit of renaming variables in Ghidra so that they make some sense. I will rename this function to <code>main</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#a6e22e>__libc_start_main</span>(main,param_2,<span style=color:#f92672>&amp;</span>stack0x00000008,FUN_00101760,FUN_001017d0,param_1,auStack_8);
</span></span></code></pre></div><h3 id=main><code>main</code></h3><p>If we double click on the newly renamed <code>main</code> function, we will see a function that has a massive cyclomatic complexity in the decompiler view.
I will try to make this more sensible by selecting the generated identifiers, then renaming (pressing <code>L</code>) and retyping (<code>Ctrl</code> <code>L</code>).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>void</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>bool</span> ok;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>bool</span> _ok;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> ret;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>long</span> n_volcano;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>long</span> n_bear;
</span></span><span style=display:flex><span>  ulong m_v;
</span></span><span style=display:flex><span>  ulong m_b;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>long</span> fs_register;
</span></span><span style=display:flex><span>  ulong bear;
</span></span><span style=display:flex><span>  ulong volcano;
</span></span><span style=display:flex><span>  ulong proof;
</span></span><span style=display:flex><span>  ulong leet;
</span></span><span style=display:flex><span>  FILE <span style=color:#f92672>*</span>flag;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>char</span> buf [<span style=color:#ae81ff>136</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>long</span> canary;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  canary <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>(<span style=color:#66d9ef>long</span> <span style=color:#f92672>*</span>)(fs_register <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x28</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setbuf</span>(stdin,(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#ae81ff>0x0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setbuf</span>(stdout,(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#ae81ff>0x0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setbuf</span>(stderr,(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#ae81ff>0x0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Give me a bear: &#34;</span>);
</span></span><span style=display:flex><span>  bear <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>scanf</span>(<span style=color:#e6db74>&#34;%llu&#34;</span>,<span style=color:#f92672>&amp;</span>bear);
</span></span><span style=display:flex><span>  ok <span style=color:#f92672>=</span> <span style=color:#a6e22e>process_bear</span>(bear);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (ok) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Give me a volcano: &#34;</span>);
</span></span><span style=display:flex><span>    volcano <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>scanf</span>(<span style=color:#e6db74>&#34;%llu&#34;</span>,<span style=color:#f92672>&amp;</span>volcano);
</span></span><span style=display:flex><span>    _ok <span style=color:#f92672>=</span> <span style=color:#a6e22e>process_volcano</span>(volcano);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (_ok) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Prove to me they are the same: &#34;</span>);
</span></span><span style=display:flex><span>      proof <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>      leet <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x1337</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>scanf</span>(<span style=color:#e6db74>&#34;%llu&#34;</span>,<span style=color:#f92672>&amp;</span>proof);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (((proof <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>||</span> (proof <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>puts</span>(<span style=color:#e6db74>&#34;That</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>s not a valid proof!&#34;</span>);
</span></span><span style=display:flex><span>        ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        n_volcano <span style=color:#f92672>=</span> <span style=color:#a6e22e>n_digits</span>(volcano);
</span></span><span style=display:flex><span>        n_bear <span style=color:#f92672>=</span> <span style=color:#a6e22e>n_digits</span>(bear);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (n_volcano <span style=color:#f92672>==</span> n_bear) {
</span></span><span style=display:flex><span>          n_volcano <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum_of_digits</span>(volcano);
</span></span><span style=display:flex><span>          n_bear <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum_of_digits</span>(bear);
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (n_volcano <span style=color:#f92672>==</span> n_bear) {
</span></span><span style=display:flex><span>            m_v <span style=color:#f92672>=</span> <span style=color:#a6e22e>check_proof</span>(leet,volcano,proof);
</span></span><span style=display:flex><span>            m_b <span style=color:#f92672>=</span> <span style=color:#a6e22e>check_proof</span>(leet,bear,proof);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (m_v <span style=color:#f92672>==</span> m_b) {
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>puts</span>(<span style=color:#e6db74>&#34;That looks right to me!&#34;</span>);
</span></span><span style=display:flex><span>              flag <span style=color:#f92672>=</span> <span style=color:#a6e22e>fopen</span>(<span style=color:#e6db74>&#34;flag.txt&#34;</span>,<span style=color:#e6db74>&#34;r&#34;</span>);
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>fgets</span>(buf,<span style=color:#ae81ff>0x80</span>,flag);
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>puts</span>(buf);
</span></span><span style=display:flex><span>              ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>goto</span> LAB_00101740;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>puts</span>(<span style=color:#e6db74>&#34;Nope that</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>s not right!&#34;</span>);
</span></span><span style=display:flex><span>        ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>puts</span>(<span style=color:#e6db74>&#34;That doesn</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>t look like a volcano!&#34;</span>);
</span></span><span style=display:flex><span>      ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>puts</span>(<span style=color:#e6db74>&#34;That doesn</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>t look like a bear!&#34;</span>);
</span></span><span style=display:flex><span>    ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>LAB_00101740:
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (canary <span style=color:#f92672>!=</span> <span style=color:#f92672>*</span>(<span style=color:#66d9ef>long</span> <span style=color:#f92672>*</span>)(fs_register <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x28</span>)) {
</span></span><span style=display:flex><span>                    <span style=color:#75715e>/* WARNING: Subroutine does not return */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>__stack_chk_fail</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> ret;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The program asks for an unsigned long integer as a bear. It calls a subroutine to process the integer
and stores the result in the <code>ok</code> variable.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Give me a bear: &#34;</span>);
</span></span><span style=display:flex><span>bear <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>scanf</span>(<span style=color:#e6db74>&#34;%llu&#34;</span>,<span style=color:#f92672>&amp;</span>bear);
</span></span><span style=display:flex><span>ok <span style=color:#f92672>=</span> <span style=color:#a6e22e>process_bear</span>(bear);
</span></span></code></pre></div><p>The next block only executes when <code>ok</code> is true.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>if</span> (ok) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>Inside this block, the program for another unsigned long integer as before but calls it a volcano, running
a check specific to this input.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Give me a volcano: &#34;</span>);
</span></span><span style=display:flex><span>volcano <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>scanf</span>(<span style=color:#e6db74>&#34;%llu&#34;</span>,<span style=color:#f92672>&amp;</span>volcano);
</span></span><span style=display:flex><span>_ok <span style=color:#f92672>=</span> <span style=color:#a6e22e>process_volcano</span>(volcano);
</span></span></code></pre></div><p>The next conditional block executes when this <code>process_volcano</code> subroutine return true.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>if</span> (_ok) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>The program then asks for another unsigned long integer as a proof for the <em>&ldquo;volcano&rdquo;</em> and the <em>&ldquo;bear&rdquo;</em> being the same.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Prove to me they are the same: &#34;</span>);
</span></span><span style=display:flex><span>proof <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>leet <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x1337</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>scanf</span>(<span style=color:#e6db74>&#34;%llu&#34;</span>,<span style=color:#f92672>&amp;</span>proof);
</span></span></code></pre></div><p>If the proof value&rsquo;s last bit (<code>proof & 1</code>) is 0, meaning if the proof is even or it is 1, we get the bad ending
that says, &ldquo;That&rsquo;s not a valid proof!&rdquo;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>if</span> (((proof <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>||</span> (proof <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>)) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>puts</span>(<span style=color:#e6db74>&#34;That</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>s not a valid proof!&#34;</span>);
</span></span><span style=display:flex><span>  ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>For the good ending, we check what&rsquo;s in the <code>else</code> block.</p><p>Here, I have renamed two functions to <code>n_digits</code> and <code>sum_of_digits</code> because that is exactly what they do.
There&rsquo;s nothing worth explaining about them in particular but you may check them if you are following along.</p><p>First we need the number of digits in the volcano and bear digits to be equal.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span>n_volcano <span style=color:#f92672>=</span> <span style=color:#a6e22e>n_digits</span>(volcano);
</span></span><span style=display:flex><span>n_bear <span style=color:#f92672>=</span> <span style=color:#a6e22e>n_digits</span>(bear);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (n_volcano <span style=color:#f92672>==</span> n_bear) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> }
</span></span></code></pre></div><p>Our second constraint is that the sum of the digits must equal for the volcano and the bear.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span>n_volcano <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum_of_digits</span>(volcano);
</span></span><span style=display:flex><span>n_bear <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum_of_digits</span>(bear);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (n_volcano <span style=color:#f92672>==</span> n_bear) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>Finally the happy ending happens when the result of a proof checking function is the same for both the numbers.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span>m_v <span style=color:#f92672>=</span> <span style=color:#a6e22e>check_proof</span>(leet,volcano,proof);
</span></span><span style=display:flex><span>m_b <span style=color:#f92672>=</span> <span style=color:#a6e22e>check_proof</span>(leet,bear,proof);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (m_v <span style=color:#f92672>==</span> m_b) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>puts</span>(<span style=color:#e6db74>&#34;That looks right to me!&#34;</span>);
</span></span><span style=display:flex><span>  flag <span style=color:#f92672>=</span> <span style=color:#a6e22e>fopen</span>(<span style=color:#e6db74>&#34;flag.txt&#34;</span>,<span style=color:#e6db74>&#34;r&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fgets</span>(buf,<span style=color:#ae81ff>0x80</span>,flag);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>puts</span>(buf);
</span></span><span style=display:flex><span>  ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>goto</span> LAB_00101740;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now, I will visit the functions that I had glossed over earlier.</p><h3 id=process_bear><code>process_bear</code></h3><p>The decompilation looks like the following after some renaming and cleanup.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>bool</span> <span style=color:#a6e22e>process_bear</span>(ulong b)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>bool</span> ret;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ((b <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (b <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (b <span style=color:#f92672>%</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (b <span style=color:#f92672>+</span> ((b <span style=color:#f92672>-</span> b <span style=color:#f92672>/</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>+</span> b <span style=color:#f92672>/</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>*</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>7</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (b <span style=color:#f92672>%</span> <span style=color:#ae81ff>0x6d</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x37</span>) {
</span></span><span style=display:flex><span>            ret <span style=color:#f92672>=</span> true;
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            ret <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>          ret <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        ret <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      ret <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    ret <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> ret;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This function gives us the constraints for the unsigned long integer represented by &ldquo;bear&rdquo;.
The function only returns true when all of the following conditions are met by the number:</p><ul><li>The last bit is zero (<code>b & 1 == 0</code>), meaning, it is even.</li><li>When divided by 3, yields the remainder of 2.</li><li>When divided by 5, yields the remainder of 1.</li><li>When divided by 0x6d, yields the remainder of 0x37.</li><li>The madness that is <code>b + ((b - b / 7 >> 1) + b / 7 >> 2) * -7 == 3</code></li></ul><p>Okay, calm down, the last part is not very hard to decipher. Let&rsquo;s work it out piece by piece.</p><p>The right shift operation (<code>>></code>) implies division by 2 to the power of something. So the innermost parenthetic expression
<code>b - b / 7 >> 1</code> means to divide <code>b - b / 7</code> by 2 to the power of 1.</p><p>When considered as a purely mathematical expression, we can perform the following simplification.</p><p><img src=../../volcano-expression-0.svg alt></p><p><img src=../../volcano-expression-1.svg alt></p><p><img src=../../volcano-expression-2.svg alt></p><p><img src=../../volcano-expression-3.svg alt></p><p><img src=../../volcano-expression-4.svg alt></p><p><img src=../../volcano-expression-5.svg alt></p><p>We can cancel the 4s in the numerator since they were results of the shift operations.</p><p><img src=../../volcano-expression-6.svg alt></p><p>However, we cannot cancel out the 7s since they were part of the C division.
Remember, the divison operation in C results in the truncated integer quotient, not a floating point number.
This means</p><p><img src=../../volcano-expression-7.svg alt></p><p>here gives us the largest multiple of 7 below <code>b</code>.</p><p>Another way to think of it is the part of <code>b</code> that is divisible by 7, leaving out the remainder.</p><p>When we subtract this from the original number, we get what was left out, the remainder itself!</p><p>The entire condition simplifies to:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span>b <span style=color:#f92672>%</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><p>This will be another constraint for the <code>bear</code> number.</p><h3 id=process_volcano><code>process_volcano</code></h3><p>The decompilation after renames looks like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>bool</span> <span style=color:#a6e22e>process_volcano</span>(ulong v)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>bool</span> ok;
</span></span><span style=display:flex><span>  ulong total_bits;
</span></span><span style=display:flex><span>  ulong i;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  total_bits <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (i <span style=color:#f92672>=</span> v; i <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>=</span> i <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    total_bits <span style=color:#f92672>=</span> total_bits <span style=color:#f92672>+</span> ((uint)i <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (total_bits <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0x11</span>) {
</span></span><span style=display:flex><span>    ok <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (total_bits <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0x1b</span>) {
</span></span><span style=display:flex><span>    ok <span style=color:#f92672>=</span> true;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    ok <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> ok;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here the program loops over the bits in the number supplied and counts the ones that are high.
The function only returns a true value when the total number of high bits is between 17 (0x11, inclusive) and 27 (0x1b, exclusive).</p><p>This is a constraint for the <code>volcano</code> number.</p><h3 id=check_proof><code>check_proof</code></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span>ulong <span style=color:#a6e22e>check_proof</span>(ulong leet,ulong v,ulong proof)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  ulong i;
</span></span><span style=display:flex><span>  ulong mod;
</span></span><span style=display:flex><span>  ulong ret;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  mod <span style=color:#f92672>=</span> leet <span style=color:#f92672>%</span> proof;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (i <span style=color:#f92672>=</span> v; i <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>=</span> i <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ((i <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      ret <span style=color:#f92672>=</span> (ret <span style=color:#f92672>*</span> mod) <span style=color:#f92672>%</span> proof;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    mod <span style=color:#f92672>=</span> (mod <span style=color:#f92672>*</span> mod) <span style=color:#f92672>%</span> proof;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> ret;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This function begins by defining a return variable as 1 and another variable <code>mod</code> as result of the <code>leet</code> modulo the proof value. I have renamed this
variable leet since 0x1337 is the only number supplied as the argument throughout the program.</p><p>It then loops over the bits of the argument <code>v</code>. If a given bit is high, the return value gets assigned itself multiplied by the <code>mod</code>, modulo the proof value.
Otherwise, the <code>mod</code> variable gets assigned itself squared, modulo the proof.</p><p>Recall that the result of this function must be equal for both the <code>volcano</code> and the <code>bear</code> number.</p><p>How do we make sure that the results are equal if there is so much of pseudo-randomness involved?</p><p>Our best option is to somehow have the <code>mod</code> variable as 1 since anything times 1 is itself.
The return value in such a case is bound to its initial value of 1 for any non-zero proof value.</p><p>For this to happen, <code>leet % proof</code> must be equal to 1. Noting that 0x1337 (4919) is the only value passed as leet,
we have the constraint</p><p><img src=../../volcano-expression-8.svg alt></p><p>The congruence can be rewritten as:</p><p><img src=../../volcano-expression-9.svg alt></p><p><img src=../../volcano-expression-10.svg alt></p><p><img src=../../volcano-expression-11.svg alt></p><p>Earlier, we noted that the proof value cannot be 1 and it cannot be even.
Thus, we need an odd proof value that divides 4918 without leaving any remainder.</p><p>The number 2 divides 4918 to give 2459, a prime number.</p><p>This implies, 2 and 2459 are the prime factors of 4918. Since 2 is even, <em>we will choose 2459 as the proof value</em>.</p><h2 id=solving-for-the-volcano-and-the-bear>Solving for the <code>volcano</code> and the <code>bear</code></h2><p>I will be writing a little Rust program to solve for the remaining constraints.</p><p>We know that the <code>volcano</code> number must have at least 17 high bits and at most 27 high bits. Hence, we will begin by
generating numbers that have 17 high bits and 1 low bit.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>let</span> ones <span style=color:#f92672>=</span> <span style=color:#ae81ff>17</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> bits <span style=color:#f92672>=</span> ones <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> volcanos <span style=color:#f92672>=</span> (<span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>bits)
</span></span><span style=display:flex><span>    .map(<span style=color:#f92672>|</span>position<span style=color:#f92672>|</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> position) <span style=color:#f92672>^</span> ((<span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> bits) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>    .collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>i32</span><span style=color:#f92672>&gt;&gt;</span>();
</span></span></code></pre></div><p>This gives us numbers that have a binary representation like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#ae81ff>111111111111111110</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>111111111111111101</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>111111111111111011</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>111111111111110111</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// and so on
</span></span></span></code></pre></div><p>For any of these numbers we wish to find a <code>bear</code> number that:</p><ul><li>is even</li><li>yields the remainder of 2 when divided by 3</li><li>yields the remainder of 1 when divided by 5</li><li>yields the remainder of 3 when divided by 7</li><li>yields the remainder of 55 when divided by 109</li><li>has the same number of digits as the <code>volcano</code></li><li>has the same sum of digits as the <code>volcano</code></li></ul><p>The naive way of solving this would be to loop from 1 to infinity and check for each of these conditions manually.
In such a case, the code would look like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>for</span> bear <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> bear <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&amp;&amp;</span> bear <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&amp;&amp;</span> bear <span style=color:#f92672>%</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&amp;&amp;</span> bear <span style=color:#f92672>%</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&amp;&amp;</span> bear <span style=color:#f92672>%</span> <span style=color:#ae81ff>109</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>55</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&amp;&amp;</span> sum_and_number_of_digits(bear) <span style=color:#f92672>==</span> sum_and_number_of_digits(volcano)
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// do something
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>However, this will be immensely time consuming and inefficient. Since all the conditions except for the ones pertaining to the digits are
modulo congruence checks, we can use the Chinese Remainder Theorem to solve for the smallest number that leaves the respective remainders
and begin from there.</p><p>Let <code>a</code> be the array of all the moduli 2, 3, 5, 7 and 109.</p><p><img src=../../volcano-expression-12.svg alt></p><p>Let <code>r</code> represent the array of the respective remainders.</p><p><img src=../../volcano-expression-13.svg alt></p><p>We begin by calculating <code>n</code> as the product of all the moduli.</p><p><img src=../../volcano-expression-14.svg alt></p><p>We construct <code>m</code> containing the modulus of each equation by diving <code>n</code> by each element of <code>a</code>.</p><p><img src=../../volcano-expression-15.svg alt></p><p>We then calculate the multiplicative modular inverse of the aforementioned moduli with respect to the original moduli.</p><p><img src=../../volcano-expression-16.svg alt></p><blockquote><p>The modular inverse of a number <code>x</code> modulo <code>m</code> is the number <code>x_inv</code> such that its product with the <code>x</code> number mod <code>m</code> is 1.</p><p><img src=../../volcano-expression-17.svg alt></p></blockquote><p>We now multiply the calculated moduli and their inverses to find out the constants that leave the remainder 1.</p><pre tabindex=0><code>Ca = Ma * Ma_inv
</code></pre><p>We multiply the remainder with each constant and add them up. The final unique solution is this number modulo <code>n</code>.</p><pre tabindex=0><code>solution = (Ca * Ra + Cb * Rb + ...) % n
</code></pre><p>The code implementation looks like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>let</span> moduli <span style=color:#f92672>=</span> [<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>109</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> remainders <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>55</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> n: <span style=color:#66d9ef>i32</span> <span style=color:#f92672>=</span> moduli.iter().product();
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> generated: Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>i32</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> moduli.iter().map(<span style=color:#f92672>|</span>m<span style=color:#f92672>|</span> n <span style=color:#f92672>/</span> m).collect();
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> inverses: Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>i32</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> generated
</span></span><span style=display:flex><span>    .iter()
</span></span><span style=display:flex><span>    .zip(moduli.iter())
</span></span><span style=display:flex><span>    .filter_map(<span style=color:#f92672>|</span>(a, m)<span style=color:#f92672>|</span> modinverse::modinverse(<span style=color:#f92672>*</span>a, <span style=color:#f92672>*</span>m))
</span></span><span style=display:flex><span>    .collect();
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> s: <span style=color:#66d9ef>i32</span> <span style=color:#f92672>=</span> inverses
</span></span><span style=display:flex><span>    .iter()
</span></span><span style=display:flex><span>    .zip(generated.iter())
</span></span><span style=display:flex><span>    .zip(remainders.iter())
</span></span><span style=display:flex><span>    .map(<span style=color:#f92672>|</span>((m, m_inv), r)<span style=color:#f92672>|</span> m <span style=color:#f92672>*</span> m_inv <span style=color:#f92672>*</span> r)
</span></span><span style=display:flex><span>    .sum();
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> solution <span style=color:#f92672>=</span> s <span style=color:#f92672>%</span> n;
</span></span></code></pre></div><p>Here, I&rsquo;m using the <a href=https://docs.rs/modinverse/latest/modinverse/>modinverse</a> crate so that I don&rsquo;t have to implement it manually. If you are following along,
run the following to add it to your Rust project:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cargo add modinverse
</span></span></code></pre></div><p>For all the <code>volcano</code> numbers generated we search for a <code>bear</code> number starting from the unique <code>solution</code> and stepping by the product of all the moduli, <code>n</code>.
Again, if any of the <code>bear</code> values has the same number of digits and the same sum of digits as the volcano number, it is valid.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>for</span> volcano <span style=color:#66d9ef>in</span> volcanos {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> v_digits <span style=color:#f92672>=</span> digits(volcano);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> bear <span style=color:#66d9ef>in</span> (solution<span style=color:#f92672>..</span>volcano).step_by(n <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>usize</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> digits(bear) <span style=color:#f92672>==</span> v_digits {
</span></span><span style=display:flex><span>            println!(<span style=color:#e6db74>&#34;volcano: </span><span style=color:#e6db74>{volcano}</span><span style=color:#e6db74>, bear: </span><span style=color:#e6db74>{bear}</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here <code>digits</code> is a function that returns a tuple of the number of digits and sum of digits for an argument.</p><p>The complete program source code becomes the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>digits</span>(<span style=color:#66d9ef>mut</span> n: <span style=color:#66d9ef>i32</span>) -&gt; (<span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> c <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> r <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> n <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        r <span style=color:#f92672>=</span> r <span style=color:#f92672>+</span> n <span style=color:#f92672>%</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span>        n <span style=color:#f92672>=</span> n <span style=color:#f92672>/</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span>        c <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    (c, r)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> ones <span style=color:#f92672>=</span> <span style=color:#ae81ff>17</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> bits <span style=color:#f92672>=</span> ones <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> volcanos <span style=color:#f92672>=</span> (<span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>bits)
</span></span><span style=display:flex><span>        .map(<span style=color:#f92672>|</span>position<span style=color:#f92672>|</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> position) <span style=color:#f92672>^</span> ((<span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> bits) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>        .collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>i32</span><span style=color:#f92672>&gt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> moduli <span style=color:#f92672>=</span> [<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>109</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> remainders <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>55</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> n: <span style=color:#66d9ef>i32</span> <span style=color:#f92672>=</span> moduli.iter().product();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> generated: Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>i32</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> moduli.iter().map(<span style=color:#f92672>|</span>m<span style=color:#f92672>|</span> n <span style=color:#f92672>/</span> m).collect();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> inverses: Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>i32</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> generated
</span></span><span style=display:flex><span>        .iter()
</span></span><span style=display:flex><span>        .zip(moduli.iter())
</span></span><span style=display:flex><span>        .filter_map(<span style=color:#f92672>|</span>(a, m)<span style=color:#f92672>|</span> modinverse::modinverse(<span style=color:#f92672>*</span>a, <span style=color:#f92672>*</span>m))
</span></span><span style=display:flex><span>        .collect();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> s: <span style=color:#66d9ef>i32</span> <span style=color:#f92672>=</span> inverses
</span></span><span style=display:flex><span>        .iter()
</span></span><span style=display:flex><span>        .zip(generated.iter())
</span></span><span style=display:flex><span>        .zip(remainders.iter())
</span></span><span style=display:flex><span>        .map(<span style=color:#f92672>|</span>((m, m_inv), r)<span style=color:#f92672>|</span> m <span style=color:#f92672>*</span> m_inv <span style=color:#f92672>*</span> r)
</span></span><span style=display:flex><span>        .sum();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> solution <span style=color:#f92672>=</span> s <span style=color:#f92672>%</span> n;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> volcano <span style=color:#66d9ef>in</span> volcanos {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> v_digits <span style=color:#f92672>=</span> digits(volcano);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> bear <span style=color:#66d9ef>in</span> (solution<span style=color:#f92672>..</span>volcano).step_by(n <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>usize</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> digits(bear) <span style=color:#f92672>==</span> v_digits {
</span></span><span style=display:flex><span>                println!(<span style=color:#e6db74>&#34;volcano: </span><span style=color:#e6db74>{volcano}</span><span style=color:#e6db74>, bear: </span><span style=color:#e6db74>{bear}</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>If we run the program using <code>cargo run</code>, we get multiple unqiue solutions to the problem:</p><pre tabindex=0><code>volcano: 262139, bear: 132926
volcano: 262139, bear: 201596
volcano: 262079, bear: 155816
volcano: 262079, bear: 224486
volcano: 258047, bear: 155816
volcano: 258047, bear: 224486
volcano: 196607, bear: 178706
</code></pre><p>Now we can connect to the challenge server, supply any of the solutions and get the flag.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>nc amt.rs <span style=color:#ae81ff>31010</span>
</span></span></code></pre></div><pre tabindex=0><code>Give me a bear: 132926
Give me a volcano: 262139
Prove to me they are the same: 2459
That looks right to me!
amateursCTF{yep_th0se_l00k_th3_s4me_to_m3!_:clueless:}
</code></pre></section><nav class=post-nav><a class=next href=https://lavafroth.is-a.dev/post/wait-an-eternity-web-challenge-amateursctf-2023/><span>Waiting an Eternity - Web Challenge | AmateursCTF 2023</span><span>→</span></a></nav></article></main><footer class=footer><p>&copy; 2023 <a href=https://lavafroth.is-a.dev/>lavafroth</a> | <a href=https://github.com/lavafroth/lavafroth.github.io/issues/new/choose>Report an issue</a> | <a href=https://github.com/lavafroth/lavafroth.github.io/discussions/>Discuss</a></p></footer></body></html>