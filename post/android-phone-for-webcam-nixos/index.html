<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Using an Android Phone as a webcam in NixOS - lavafroth</title><meta name=description content='I recently had to attend an online meeting for a software development event.
While my PC did have a decent microphone, the built-in camera has been damaged to the extent that the best it can capture is this:

No, it&rsquo;s not a close-up of the moon, it&rsquo;s the refraction caused by the scuffs to the lens plus other sciency stuff I&rsquo;m not qualified enough to explain to you.'><meta name=author content><link rel="preload stylesheet" as=style href=https://lavafroth.is-a.dev/app.min.css><link rel="preload stylesheet" href=../../header.svg><noscript><link rel="preload stylesheet" as=style href=https://lavafroth.is-a.dev/noscript.min.css></noscript><link rel=preload as=font href=https://lavafroth.is-a.dev/LeagueGothic.ttf><link as=font href=https://lavafroth.is-a.dev/latinmodern-math.otf><link rel=preload as=image href=https://lavafroth.is-a.dev/github.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/about.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/art.svg><link rel=icon href=https://lavafroth.is-a.dev/favicon.png><link rel=blog-icon href=https://lavafroth.is-a.dev/icon.png></head><body class=not-ready data-menu=true><header class=header><h1><a class=site-name href=https://lavafroth.is-a.dev/>lavafroth</a></h1><svg id="btnDark" class="btn-dark" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 60 60" preserveAspectRatio="xMinYMin meet"><path class="circle" d="M30 16c7.73.0 14 6.27 14 14 0 3.81-1.53 7.27-4 9.8-2.54 2.59-6.08 4.2-10 4.2-7.73.0-14-6.27-14-14 0-7.73 6.27-14 14-14z"/><g class="rays" data-svg-origin="30 30"><line class="line" x1="30" y1="11" x2="30" y2="7"/><line class="line" x1="43.44" y1="16.57" x2="46.26" y2="13.74"/><line class="line" x1="49" y1="30" x2="53" y2="30"/><line class="line" x1="43.43" y1="43.44" x2="46.26" y2="46.26"/><line class="line" x1="30" y1="49" x2="30" y2="53"/><line class="line" x1="16.56" y1="43.43" x2="13.74" y2="46.26"/><line class="line" x1="11" y1="30" x2="7" y2="30"/><line class="line" x1="16.57" y1="16.56" x2="13.74" y2="13.74"/></g></svg><div class=space></div><a style=--url:url(./github.svg) href=https://github.com/lavafroth aria-label=github target=_blank></a><a href=../../about/ aria-label=about style=--url:url(./about.svg)></a><a href=../../art/ aria-label=art style=--url:url(./art.svg)></a><script>const bodyClx=document.body.classList,sysDark=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark"),setDark=e=>(bodyClx.toggle("dark",e),localStorage.setItem("dark",e));setDark(darkVal?darkVal==="true":sysDark.matches),requestAnimationFrame(()=>bodyClx.remove("not-ready")),btnDark.addEventListener("click",()=>setDark(!bodyClx.contains("dark"))),sysDark.addEventListener("change",({matches:e})=>setDark(e))</script></header><main class=main><article class=post-single><header class=post-title><p><time>Mar 10, 2024 | 4 minutes read</time></p><h1 data-pagefind-meta=title>Using an Android Phone as a webcam in NixOS</h1></header><section class=post-content data-pagefind-body><p>I recently had to attend an online meeting for a software development event.
While my PC did have a decent microphone, the built-in camera has been damaged to the extent that the best it can capture is this:</p><p><img src=../../pc-camera.avif alt="A blurry image taken from my scuffed camera"></p><p>No, it&rsquo;s not a close-up of the moon, it&rsquo;s the refraction caused by the scuffs to the lens plus other sciency stuff I&rsquo;m not qualified enough to explain to you.</p><p>I was aware that one can use ADB to use an Android phone&rsquo;s camera as a makeshift webcam. Since I would need this ability for any future meetings as well, it was worth having the functionality packaged into a one click tool.</p><p>Enter NixOS. I have praised NixOS before and I&rsquo;ll do it again because of the sheer ease with which it allows me to create desktop entries for small scripts.
This is going to be relevant later but I&rsquo;m going to assume that you&rsquo;re running NixOS with home-manager enabled if you&rsquo;re following along. First we have to <a href=https://developer.android.com/studio/debug/dev-options#enable>enable developer mode and USB debugging on our phone</a>.</p><p>To interact with our phone, we will need <code>adb</code> and <code>scrcpy</code> as dependencies.
If you have enabled flakes run the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>nix shell nixpkgs#scrcpy nixpkgs#android-tools
</span></span></code></pre></div><p>If you don&rsquo;t have flakes enabled, run the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>nix-shell -p scrcpy android-tools
</span></span></code></pre></div><p>Next, we connect our phone to our PC with a cable (or through ADB TCP/IP) and list all the cameras by running the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>scrcpy --list-cameras
</span></span></code></pre></div><p>You must allow any prompt on your phone requesting access to it from the
computer, after which, you should see an output like the following:</p><pre tabindex=0><code>[server] INFO: List of cameras:
    --camera-id=0    (back, 4608x3456, fps=[10, 15, 24, 30])
    --camera-id=1    (front, 2304x1728, fps=[15, 24, 30])
    --camera-id=2    (back, 3264x2448, fps=[15, 24, 30])
    --camera-id=3    (back, 1600x1200, fps=[15, 24, 30])
    --camera-id=4    (back, 1600x1200, fps=[15, 24, 30])
    --camera-id=5    (back, 4608x3456, fps=[10, 15, 24, 30])
    --camera-id=6    (back, 4608x3456, fps=[10, 15, 24, 30])
    --camera-id=7    (back, 4608x3456, fps=[10, 15, 24, 30])
</code></pre><p>Note down the number associated with the camera you want to use. Alternatively, you can also note whether the camera you wish to use is the front or the back camera.</p><p>Add the following to your <code>configuration.nix</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>boot <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  kernelModules <span style=color:#f92672>=</span> [ <span style=color:#e6db74>&#34;v4l2loopback&#34;</span> ];
</span></span><span style=display:flex><span>  extraModulePackages <span style=color:#f92672>=</span> [ pkgs<span style=color:#f92672>.</span>linuxPackages<span style=color:#f92672>.</span>v4l2loopback ];
</span></span><span style=display:flex><span>  extraModprobeConfig <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    options v4l2loopback exclusive_caps=1 card_label=&#34;Virtual Webcam&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;&#39;</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>This enables the <code>v4l2loopback</code> kernel module to create a dummy video interface which allows us to route any video to this virtual camera.
In the extra options for this module, we have to add <code>exclusive_caps=1</code> to make sure that the virtual camera exclusively announces itself as an output device.
This is important for compatibility with services like Zoom and Google Meet.</p><p>In the home-manager config for your user add the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>home<span style=color:#f92672>.</span>xdg<span style=color:#f92672>.</span>desktopEntries<span style=color:#f92672>.</span>andcam <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Android Virtual Camera&#34;</span>;
</span></span><span style=display:flex><span>  exec <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>pkgs<span style=color:#f92672>.</span>writeScript <span style=color:#e6db74>&#34;andcam&#34;</span> <span style=color:#e6db74>&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    </span><span style=color:#e6db74>${</span>pkgs<span style=color:#f92672>.</span>android-tools<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/adb start-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    </span><span style=color:#e6db74>${</span>pkgs<span style=color:#f92672>.</span>scrcpy<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/scrcpy --camera-facing=back --video-source=camera --no-audio --v4l2-sink=/dev/video0 -m1024
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>This creates a desktop entry with the name <em>&ldquo;Android Virtual Camera&rdquo;</em> and runs
the script in the <code>exec</code> field.</p><p>Here&rsquo;s a breakdown of the script:</p><ul><li>The first line starts an ADB server required for <code>scrcpy</code> to pick up our device.</li><li>The second line runs <code>scrcpy</code> to pass the phone&rsquo;s camera to the dummy virtual camera spawned by the <code>v4l2loopback</code> kernel module.</li></ul><p>We can use a named camera with the <code>--camera-facing</code> flag as I did here for
the back camera using <code>--camera-facing=back</code>. If you noted a camera ID eariler,
you can replace the <code>--camera-facing=back</code> with <code>--camera-id=</code> followed by the
identifying number.</p><p>For example, if you were to use the camera with the ID 0, you would add the following instead:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>home<span style=color:#f92672>.</span>xdg<span style=color:#f92672>.</span>desktopEntries<span style=color:#f92672>.</span>andcam <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Android Virtual Camera&#34;</span>;
</span></span><span style=display:flex><span>  exec <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>pkgs<span style=color:#f92672>.</span>writeScript <span style=color:#e6db74>&#34;andcam&#34;</span> <span style=color:#e6db74>&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    </span><span style=color:#e6db74>${</span>pkgs<span style=color:#f92672>.</span>android-tools<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/adb start-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    </span><span style=color:#e6db74>${</span>pkgs<span style=color:#f92672>.</span>scrcpy<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/scrcpy --camera-id=0 --video-source=camera --no-audio --v4l2-sink=/dev/video0 -m1024
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Now rebuild your system and reboot.</p><p>That&rsquo;s it! Connect your phone to your PC and run on the <em>&ldquo;Android Virtual Camera&rdquo;</em> menu entry.</p><p>I was impressed that this has been possible on Linux since 2018 while
<a href=https://blogs.windows.com/windows-insider/2024/02/29/ability-to-use-a-mobile-devices-camera-as-a-webcam-on-your-pc-begins-rolling-out-to-windows-insiders/>Microsoft is introducing this feature now to Windows 11</a>.</p><p>Remember kids, what Windows can be tomorrow, Linux is today. That&rsquo;s all for now,
see you around!</p></section></article><footer class=post-tags data-pagefind-meta=tags><a href=https://lavafroth.is-a.dev/tags/workflow class=list-tag>Workflow</a>
<a href=https://lavafroth.is-a.dev/tags/meta class=list-tag>Meta</a>
<a href=https://lavafroth.is-a.dev/tags/nixos class=list-tag>NixOS</a>
<a href=https://lavafroth.is-a.dev/tags/android class=list-tag>Android</a></footer><nav class=post-nav><a class=prev href=https://lavafroth.is-a.dev/post/wayland-tools-rock/><span>←</span><span>Wayland Tools Rock!</span></a>
<a class=next href=https://lavafroth.is-a.dev/post/kringlecon-2023-writeup/><span>Kringlecon 2023 Writeup</span><span>→</span></a></nav></main><footer class=footer><p>&copy; 2025 <a href=https://lavafroth.is-a.dev/>lavafroth</a></p><p><a href=https://github.com/lavafroth/lavafroth.github.io/issues/new/choose>Report an issue</a></p><p><a href=https://github.com/lavafroth/lavafroth.github.io/discussions/>Discuss</a></p><p><a href=https://lavafroth.is-a.dev/privacy>Privacy</a></p><p><a href=https://creativecommons.org/licenses/by-sa/4.0/legalcode>License</a></p></footer></body></html>