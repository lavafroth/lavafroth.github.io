<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>A Tale of a Frugal Home Server - lavafroth</title><meta name=description content='Having run an on-premise server for the past two years, I think my setup has finally
matured enough to be worth talking about.
At any point, you can check out the source code for the server&rsquo;s infrastructure here for a concrete example.
For each service I talk about, I will also link the respective definitions in my config.
My minimalist mindset has unsurprisingly aided the architecture of my server.
Throughout the rest of the post, you will come across the following broad strokes:'><meta name=author content><link rel="preload stylesheet" as=style href=https://lavafroth.is-a.dev/app.min.css><link rel="preload stylesheet" href=../../header.svg><noscript><link rel="preload stylesheet" as=style href=https://lavafroth.is-a.dev/noscript.min.css></noscript><link rel=preload as=font href=https://lavafroth.is-a.dev/LeagueGothic.ttf><link as=font href=https://lavafroth.is-a.dev/latinmodern-math.otf><link rel=preload as=image href=https://lavafroth.is-a.dev/github.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/about.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/art.svg><link rel=icon href=https://lavafroth.is-a.dev/favicon.png><link rel=blog-icon href=https://lavafroth.is-a.dev/icon.png></head><body class=not-ready data-menu=true><header class=header><h1><a class=site-name href=https://lavafroth.is-a.dev/>lavafroth</a></h1><svg id="btnDark" class="btn-dark" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 60 60" preserveAspectRatio="xMinYMin meet"><path class="circle" d="M30 16c7.73.0 14 6.27 14 14 0 3.81-1.53 7.27-4 9.8-2.54 2.59-6.08 4.2-10 4.2-7.73.0-14-6.27-14-14 0-7.73 6.27-14 14-14z"/><g class="rays" data-svg-origin="30 30"><line class="line" x1="30" y1="11" x2="30" y2="7"/><line class="line" x1="43.44" y1="16.57" x2="46.26" y2="13.74"/><line class="line" x1="49" y1="30" x2="53" y2="30"/><line class="line" x1="43.43" y1="43.44" x2="46.26" y2="46.26"/><line class="line" x1="30" y1="49" x2="30" y2="53"/><line class="line" x1="16.56" y1="43.43" x2="13.74" y2="46.26"/><line class="line" x1="11" y1="30" x2="7" y2="30"/><line class="line" x1="16.57" y1="16.56" x2="13.74" y2="13.74"/></g></svg><div class=space></div><a style=--url:url(./github.svg) href=https://github.com/lavafroth aria-label=github target=_blank></a><a href=../../about/ aria-label=about style=--url:url(./about.svg)></a><a href=../../art/ aria-label=art style=--url:url(./art.svg)></a><script>const bodyClx=document.body.classList,sysDark=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark"),setDark=e=>(bodyClx.toggle("dark",e),localStorage.setItem("dark",e));setDark(darkVal?darkVal==="true":sysDark.matches),requestAnimationFrame(()=>bodyClx.remove("not-ready")),btnDark.addEventListener("click",()=>setDark(!bodyClx.contains("dark"))),sysDark.addEventListener("change",({matches:e})=>setDark(e))</script></header><main class=main><article class=post-single><header class=post-title><p><time>Jan 4, 2025 | 5 minutes read</time></p><h1 data-pagefind-meta=title>A Tale of a Frugal Home Server</h1></header><section class=post-content data-pagefind-body><p>Having run an on-premise server for the past two years, I think my setup has finally
matured enough to be worth talking about.</p><p>At any point, you can check out the source code for the server&rsquo;s infrastructure <a href=https://github.com/lavafroth/dotfiles/tree/main/hosts/rahu>here</a> for a concrete example.
For each service I talk about, I will also link the respective definitions in my config.</p><p>My minimalist mindset has unsurprisingly aided the architecture of my server.
Throughout the rest of the post, you will come across the following broad strokes:</p><ul><li>Easy is not always simple</li><li>Simple is better than easy</li><li>There must be one (and exactly one) way of doing something</li></ul><h2 id=hardware>Hardware</h2><p>The server is an old laptop which was on the verge becoming e-waste. Despite having a touchscreen
display, the LCD had been battered into shards, making it no better than a shiny paperweight.</p><p>Although one could have kept the display, I carefully disassembled the machine to disconnect the corresponding
ribbon cable because we are aiming for a headless setup.</p><p>Removing the display reduced the power draw to 4 watts at idle. Thus, I would highly recommend it.</p><p><img src=../../home-server/server.png alt="A picture of the home server sans the display"></p><h2 id=software>Software</h2><p>I have seen a lot of people grow monstrous fleets of docker containers in the name of &ldquo;simplicity&rdquo; and ease of use.
Yet others take this further with dedicated operating systems like CasaOS to install containerized services in a single click.</p><p>Sure, these solutions might be easy but they are certainly not simple.
Containers introduce the overhead of Linux kernel namespaces. This means
accessing files on the host additionally requires creating a mount namespace.</p><p>To avoid all of that overhead, I opted for NixOS.</p><p>With NixOS, I can define the state of my system in a single configuration file, ensuring that the services
are running close to bare metal without any abstractions. Most of the services require adding something along the lines of</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>services<span style=color:#f92672>.</span>myservicename<span style=color:#f92672>.</span>enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span></code></pre></div><p>to the configuration file and issuing a system rebuild with the <code>nixos-rebuild</code> command.</p><h3 id=storage-management>Storage Management</h3><p>Initially, I had configured three different routes to transfer files to the server.
Of these, only one service is in use today.</p><h4 id=syncthing>Syncthing</h4><p>I had enabled Syncthing to automatically synchronize media from my phone. While it is a decent solution for a lot
of use cases, <em>it does not support partially sharing the contents of a directory</em>. This annoying &lsquo;all or nothing&rsquo; nature
of Syncthing&rsquo;s file sharing is what drove me away from it.</p><h4 id=samba>Samba</h4><p>A lot of people recommended samba because of its support on almost all platforms. However, it turned out to be extremely
slow. Yes, it boasts fancy video streaming capabilities but there are better solutions to building a media library than
manually searching for a file like a caveman.</p><h4 id=sshfs-source>SSHFS (<a href=https://github.com/lavafroth/dotfiles/blob/c17a6053211145b08815cfaa0fe645c449e55ebd/hosts/rahu/configuration.nix#L154>source</a>)</h4><p>SSHFS is the sneaky third option that made the win! It is often referred to as SFTP (Secure File Transfer Protocol)
but the filesystem is usually FUSE mounted as <code>sshfs</code>.</p><p>The added advantage is that the connections go over SSH and uses the same credentials we would use to log into the server
as our user.</p><p>SFTP is fast and available on almost all platforms:</p><ul><li>Linux: Native support</li><li>Android: Native support on some devices. Alternatively, use <a href="https://play.google.com/store/apps/details?id=me.zhanghai.android.files&amp;hl=en-US">Material Files</a></li><li>Windows: Supported through <a href=https://winscp.net/eng/index.php>WinSCP</a></li><li>iOS: Suppported through <a href=https://pisth.github.io/ios/>Pisth</a></li></ul><h3 id=freedom-from-the-botnet>Freedom from the Botnet</h3><p>Finally, we can talk about weeding out the proprietary services that are holding us back
and replacing them with more privacy respecting alternatives.</p><h4 id=google-photos--photoprism-source>Google Photos → Photoprism (<a href=https://github.com/lavafroth/dotfiles/blob/c17a6053211145b08815cfaa0fe645c449e55ebd/hosts/rahu/configuration.nix#L19C1-L27C5>source</a>)</h4><p>Since I backup my phone&rsquo;s camera roll to the server, it&rsquo;s often nice to have these photos and videos
tagged and organized. Photoprism packs all the functionality of Google Photos including tagging people,
pets and places in photos, as well as searching through them along the timeline.</p><p><img src=../../home-server/photoprism.png alt></p><h4 id=netflix--spotify--jellyfin>Netflix / Spotify → Jellyfin</h4><p>Instead of overpriced and restrictive services like Netflix or Spotify that shove ads in your face
even if you have paid for them, I have migrated to buying pieces of media including movies
and music, ripping them off the discs and saving them on the server. This way we don&rsquo;t have to sit
through piles of DVDs to find out a movie to rewatch.</p><p>Albeit there&rsquo;s a caveat to this, media that is not sold in physical copies.</p><p>I have set Jellyfin to monitor a directory where I store the ripped media from the CDs or DVDs.
Jellyfin then automatically updates its catalogue (index) when something new is added.</p><p>For music, Jellyfin also supports adding lyrics through <code>.lrc</code> files. A feature that is paywalled
on services like Spotify.</p><p>Here&rsquo;s a screenshot of the one album I have so far.</p><p><img src=../../home-server/jellyfin.png alt></p><h2 id=finishing-thoughts>Finishing thoughts</h2><p>Using Nix for infrastructure has been a great success in my books. One of the greatest appeals is that
there&rsquo;s little to no setup involved for most of the services, because someone else has already figured
that out for you!</p><p>I have also enabled automatic updates which are scheduled every week. This works while leaving a backup of
the last known working state (generation), so even if the update fails, the server <em>must</em> keep working.
There&rsquo;s simply no way for the software side of the server to break.</p><p>What does that mean to an outsider? Less tech savvy people in my family just need to power the machine on
if it isn&rsquo;t already. That&rsquo;s it!</p><p>Sysadmins need not apply.</p></section></article><footer class=post-tags data-pagefind-meta=tags><a href=https://lavafroth.is-a.dev/tags/nixos class=list-tag>NixOS</a>
<a href=https://lavafroth.is-a.dev/tags/home-server class=list-tag>Home Server</a>
<a href=https://lavafroth.is-a.dev/tags/automation class=list-tag>Automation</a>
<a href=https://lavafroth.is-a.dev/tags/jellyfin class=list-tag>Jellyfin</a>
<a href=https://lavafroth.is-a.dev/tags/photoprism class=list-tag>Photoprism</a></footer><nav class=post-nav><a class=prev href=https://lavafroth.is-a.dev/post/picoctf-sansalpha-writeup/><span>←</span><span>PicoCTF SansAlpha Writeup</span></a>
<a class=next href=https://lavafroth.is-a.dev/post/nixos-secureboot-shenanigans/><span>NixOS Secureboot Shenanigans</span><span>→</span></a></nav></main><footer class=footer><p>&copy; 2025 <a href=https://lavafroth.is-a.dev/>lavafroth</a></p><p><a href=https://github.com/lavafroth/lavafroth.github.io/issues/new/choose>Report an issue</a></p><p><a href=https://github.com/lavafroth/lavafroth.github.io/discussions/>Discuss</a></p><p><a href=https://lavafroth.is-a.dev/privacy>Privacy</a></p><p><a href=https://creativecommons.org/licenses/by-sa/4.0/legalcode>License</a></p></footer></body></html>