<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Java Script Kiddie 2 - lavafroth</title><meta name=description content='The challenge
This is a web challenge involving javascript, meaning most of the solution is
going to be client side. We are asked to visit the challenge
page.
From here, we can view the source code of the page.
<html>
	<head>    
		<script src="jquery-3.3.1.min.js"></script>
		<script>
			var bytes = [];
			$.get("bytes", function(resp) {
				bytes = Array.from(resp.split(" "), x => Number(x));
			});

			function assemble_png(u_in){
				var LEN = 16;
				var key = "00000000000000000000000000000000";
				var shifter;
				if(u_in.length == key.length){
					key = u_in;
				}
				var result = [];
				for(var i = 0; i < LEN; i++){
					shifter = Number(key.slice((i*2),(i*2)+1));
					for(var j = 0; j < (bytes.length / LEN); j ++){
						result[(j * LEN) + i] = bytes[(((j + shifter) * LEN) % bytes.length) + i]
					}
				}
				while(result[result.length-1] == 0){
					result = result.slice(0,result.length-1);
				}
				document.getElementById("Area").src = "data:image/png;base64," + btoa(String.fromCharCode.apply(null, new Uint8Array(result)));
				return false;
			}
		</script>
	</head>
	<body>

		<center>
			<form action="#" onsubmit="assemble_png(document.getElementById(&#39;user_in&#39;).value)">
				<input type="text" id="user_in">
				<input type="submit" value="Submit">
			</form>
			<img id="Area" src=""/>
		</center>

	</body>
</html>
Let&rsquo;s break it down. We are going to begin with the contents in the script
tags. First, the script fetches a blob of whitespace separated numbers into the
variable bytes.'><meta name=author content><link rel="preload stylesheet" as=style href=https://lavafroth.is-a.dev/app.min.css><link rel=preload as=image href=../../header.svg><link as=font href=https://lavafroth.is-a.dev/latinmodern-math.otf><link rel=preload as=image href=https://lavafroth.is-a.dev/github.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/about.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/art.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/rss.svg><link rel=icon href=https://lavafroth.is-a.dev/favicon.png><link rel=blog-icon href=https://lavafroth.is-a.dev/icon.png></head><body><header><a class=site-name href=https://lavafroth.is-a.dev/><svg viewBox="0 0 8790 2080"><path d="M80 1935V465h216v1270h286v2e2zm853 0 222-1470h264l222 1470h-210l-40-3e2h-208l-40 3e2zm280-528h148l-62-494-6-78h-12l-6 78zm1025 528L2014 465h210l108 868 8 142h12l8-142 108-868h210l-224 1470zm813 0 222-1470h264l222 1470h-210l-40-3e2h-208l-40 3e2zm280-528h148l-62-494-6-78h-12l-6 78zm851 528V465h514v222h-298v386h2e2v222h-2e2v640zm910 0V465h216q194 0 286 108 92 107 92 316 0 124-43 215-44 90-106 132l147 699h-216l-122-620h-38v620zm216-820q60 0 95-26 35-27 50-76t15-116q0-105-34-161-35-57-126-57zm1084 836q-90 0-154-42-65-42-99-114-35-72-35-162V767q0-91 35-162 34-72 99-114 64-42 154-42t155 42q64 42 99 114 34 72 34 162v866q0 90-34 162-35 72-99 114-65 42-155 42zm0-210q40 0 56-33 16-34 16-75V767q0-41-17-74-17-34-55-34-37 0-54 34-18 33-18 74v866q0 41 17 75 17 33 55 33zm890 194V687h-204V465h624v222h-204v1248zm828 0V465h216v608h168V465h216v1470h-216v-640h-168v640z"/></svg></a><nav><a style=--url:url(./github.svg) href=https://github.com/lavafroth aria-label=github target=_blank></a><a href=../../about/ aria-label=about style=--url:url(./about.svg)></a><a href=../../art/ aria-label=art style=--url:url(./art.svg)></a><a href=../../index.xml aria-label=rss style=--url:url(./rss.svg)></a><nav></header><main><hgroup data-pagefind-body><p data-pagefind-ignore><time>Mar 3, 2023 | 4 minutes read</time></p><h1 data-pagefind-meta=title>Java Script Kiddie 2</h1></hgroup><section class=post-content data-pagefind-body><h2 id=the-challenge>The challenge</h2><p>This is a web challenge involving javascript, meaning most of the solution is
going to be client side. We are asked to visit the <a href=http://jupiter.challenges.picoctf.org:42899/>challenge
page</a>.</p><p>From here, we can view the source code of the page.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>head</span>&gt;    
</span></span><span style=display:flex><span>		&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;jquery-3.3.1.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>		&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>bytes</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;bytes&#34;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>resp</span>) {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>bytes</span> <span style=color:#f92672>=</span> Array.<span style=color:#a6e22e>from</span>(<span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34; &#34;</span>), <span style=color:#a6e22e>x</span> =&gt; Number(<span style=color:#a6e22e>x</span>));
</span></span><span style=display:flex><span>			});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>assemble_png</span>(<span style=color:#a6e22e>u_in</span>){
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>LEN</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;00000000000000000000000000000000&#34;</span>;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>shifter</span>;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>u_in</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>key</span>.<span style=color:#a6e22e>length</span>){
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>u_in</span>;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>LEN</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>shifter</span> <span style=color:#f92672>=</span> Number(<span style=color:#a6e22e>key</span>.<span style=color:#a6e22e>slice</span>((<span style=color:#a6e22e>i</span><span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>),(<span style=color:#a6e22e>i</span><span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>)<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>));
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>LEN</span>); <span style=color:#a6e22e>j</span> <span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>						<span style=color:#a6e22e>result</span>[(<span style=color:#a6e22e>j</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>LEN</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>bytes</span>[(((<span style=color:#a6e22e>j</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>shifter</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>LEN</span>) <span style=color:#f92672>%</span> <span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>length</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span>]
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>while</span>(<span style=color:#a6e22e>result</span>[<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>length</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>0</span>,<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>length</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;Area&#34;</span>).<span style=color:#a6e22e>src</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;data:image/png;base64,&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>btoa</span>(String.<span style=color:#a6e22e>fromCharCode</span>.<span style=color:#a6e22e>apply</span>(<span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Uint8Array</span>(<span style=color:#a6e22e>result</span>)));
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>	&lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		&lt;<span style=color:#f92672>center</span>&gt;
</span></span><span style=display:flex><span>			&lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;#&#34;</span> <span style=color:#a6e22e>onsubmit</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;assemble_png(document.getElementById(&#39;user_in&#39;).value)&#34;</span>&gt;
</span></span><span style=display:flex><span>				&lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;user_in&#34;</span>&gt;
</span></span><span style=display:flex><span>				&lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Submit&#34;</span>&gt;
</span></span><span style=display:flex><span>			&lt;/<span style=color:#f92672>form</span>&gt;
</span></span><span style=display:flex><span>			&lt;<span style=color:#f92672>img</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Area&#34;</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>/&gt;
</span></span><span style=display:flex><span>		&lt;/<span style=color:#f92672>center</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	&lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><p>Let&rsquo;s break it down. We are going to begin with the contents in the script
tags. First, the script fetches a blob of whitespace separated numbers into the
variable <code>bytes</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>bytes</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span><span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;bytes&#34;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>resp</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>bytes</span> <span style=color:#f92672>=</span> Array.<span style=color:#a6e22e>from</span>(<span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34; &#34;</span>), <span style=color:#a6e22e>x</span> =&gt; Number(<span style=color:#a6e22e>x</span>));
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>It will be a good idea to download a copy of these bytes for ourselves.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wget http://jupiter.challenges.picoctf.org:42899/bytes
</span></span></code></pre></div><p>The function <code>assemble_png</code> takes a 32 characters long key as an input, as is evident from the length of the variable key and the assignment of <code>u_in</code> to key only when their lengths match.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>LEN</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;00000000000000000000000000000000&#34;</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>shifter</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>u_in</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>key</span>.<span style=color:#a6e22e>length</span>){
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>u_in</span>;
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><p>The function then iterates over the key to store every other byte into the <code>shifter</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>shifter</span> <span style=color:#f92672>=</span> Number(<span style=color:#a6e22e>key</span>.<span style=color:#a6e22e>slice</span>((<span style=color:#a6e22e>i</span><span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>),(<span style=color:#a6e22e>i</span><span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>)<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>));
</span></span></code></pre></div><p>The inner loop then fills up 16 contiguous bytes of the <code>result</code> array from the index <code>j * LEN</code> by a table lookup into the <code>bytes</code> array initialized earlier.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>LEN</span>); <span style=color:#a6e22e>j</span> <span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>result</span>[(<span style=color:#a6e22e>j</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>LEN</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>bytes</span>[(((<span style=color:#a6e22e>j</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>shifter</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>LEN</span>) <span style=color:#f92672>%</span> <span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>length</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=solution>Solution</h2><p>Let&rsquo;s write a python script to automate searching for the key. We can narrow down our key space since a PNG file has its header (first set of bytes) as <code>\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR</code>.
We will use numpy to broadcast arithmetic operations over all elements of a tensor (rank 1 here, meaning an array). Since the key has one byte from the PNG header and another unknown byte
alternatively, we can begin by using a dummy byte like &lsquo;A&rsquo; for all those spaces.</p><p>We then try to generate an image from the resultant byte array and validate it with the python image library (PIL). If the validation succeeds, we can end the search and save the image.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>import</span> itertools
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> itsdangerous <span style=color:#f92672>import</span> base64_encode
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> PIL <span style=color:#f92672>import</span> Image, UnidentifiedImageError
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> io
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LEN <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;bytes&#39;</span>) <span style=color:#66d9ef>as</span> handle:
</span></span><span style=display:flex><span>    blob <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array([int(x<span style=color:#f92672>.</span>strip()) <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> handle<span style=color:#f92672>.</span>read()<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;,&#39;</span>)])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>BLEN <span style=color:#f92672>=</span> len(blob)
</span></span><span style=display:flex><span>J <span style=color:#f92672>=</span> BLEN <span style=color:#f92672>//</span> LEN
</span></span><span style=display:flex><span>crib <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x89</span><span style=color:#e6db74>PNG</span><span style=color:#ae81ff>\r\n\x1a\n\x00\x00\x00\r</span><span style=color:#e6db74>IHDR&#34;</span>
</span></span><span style=display:flex><span>charset <span style=color:#f92672>=</span> [set()] <span style=color:#f92672>*</span> LEN
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_png</span>(key) <span style=color:#f92672>-&gt;</span> bool:
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> bytearray(BLEN)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(LEN):
</span></span><span style=display:flex><span>        shifter <span style=color:#f92672>=</span> ord(key[i <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(J):
</span></span><span style=display:flex><span>            result[(j <span style=color:#f92672>*</span> LEN) <span style=color:#f92672>+</span> i] <span style=color:#f92672>=</span> blob[(((j <span style=color:#f92672>+</span> shifter) <span style=color:#f92672>*</span> LEN) <span style=color:#f92672>%</span> BLEN) <span style=color:#f92672>+</span> i]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    result<span style=color:#f92672>.</span>rstrip(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        image <span style=color:#f92672>=</span> Image<span style=color:#f92672>.</span>open(io<span style=color:#f92672>.</span>BytesIO(result))
</span></span><span style=display:flex><span>        image<span style=color:#f92672>.</span>save(base64_encode(key)<span style=color:#f92672>.</span>decode() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.png&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> UnidentifiedImageError:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># 255 is the maximum value for a u8</span>
</span></span><span style=display:flex><span>    shifter <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>arange(<span style=color:#ae81ff>256</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(LEN):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(J):
</span></span><span style=display:flex><span>            crib_index <span style=color:#f92672>=</span> (j <span style=color:#f92672>*</span> LEN) <span style=color:#f92672>+</span> i
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> crib_index <span style=color:#f92672>&gt;=</span> len(crib):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            interp <span style=color:#f92672>=</span> (((shifter <span style=color:#f92672>+</span> j) <span style=color:#f92672>*</span> LEN) <span style=color:#f92672>%</span> BLEN) <span style=color:#f92672>+</span> i
</span></span><span style=display:flex><span>            p <span style=color:#f92672>=</span> shifter[np<span style=color:#f92672>.</span>in1d(interp, np<span style=color:#f92672>.</span>where(blob <span style=color:#f92672>==</span> crib[crib_index])[<span style=color:#ae81ff>0</span>])]
</span></span><span style=display:flex><span>            charset[i] <span style=color:#f92672>=</span> charset[i]<span style=color:#f92672>.</span>union(p)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> char <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>product(<span style=color:#f92672>*</span>charset):
</span></span><span style=display:flex><span>        key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;A&#34;</span><span style=color:#f92672>.</span>join(map(chr, char))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> is_png(key):
</span></span><span style=display:flex><span>            print(key)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><p>Running this script, we get the following image in <code>B0EGQQFBBkEAQQdBw6BBAUEFQQBBAEEAQQJBAEEIQQU.png</code>.
<img src=../../B0EGQQFBBkEAQQdBw6BBAUEFQQBBAEEAQQJBAEEIQQU.png alt=B0EGQQFBBkEAQQdBw6BBAUEFQQBBAEEAQQJBAEEIQQU.png></p><p>Since this appears to be a QR code, the only thing left to do is scan the image with a tool like <code>zbarimg</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>zbarimg B0EGQQFBBkEAQQdBw6BBAUEFQQBBAEEAQQJBAEEIQQU.png 
</span></span></code></pre></div><p>This yields us the flag.</p><pre tabindex=0><code>QR-Code:picoCTF{227c2d3465a6a4bcc8a1bc599e34f074}
scanned 1 barcode symbols from 1 images in 0.03 seconds
</code></pre></section><footer class=post-tags data-pagefind-meta=tags><a href=https://lavafroth.is-a.dev/tags/ctf class=list-tag>CTF</a>
<a href=https://lavafroth.is-a.dev/tags/image-reconstruction class=list-tag>Image Reconstruction</a>
<a href=https://lavafroth.is-a.dev/tags/javascript class=list-tag>Javascript</a>
<a href=https://lavafroth.is-a.dev/tags/reverse-engineering class=list-tag>Reverse Engineering</a>
<a href=https://lavafroth.is-a.dev/tags/picoctf class=list-tag>PicoCTF</a>
<a href=https://lavafroth.is-a.dev/tags/web class=list-tag>Web</a></footer><nav data-post><a href=https://lavafroth.is-a.dev/post/picoctf-web-java-code-analysis/><span>←</span><span>Java Code Analysis!?!</span></a>
<a href=https://lavafroth.is-a.dev/post/picoctf-web-some-assembly-required-3/><span>Some Assembly Required 3</span><span>→</span></a></nav></main><footer class=footer><p>&copy; 2026 <a href=https://lavafroth.is-a.dev/>lavafroth</a></p><p><a href=https://github.com/lavafroth/lavafroth.github.io/issues/new/choose>Report an issue</a></p><p><a href=https://github.com/lavafroth/lavafroth.github.io/discussions/>Discuss</a></p><p><a href=https://lavafroth.is-a.dev/privacy>Privacy</a></p><p><a href=https://creativecommons.org/licenses/by-sa/4.0/legalcode>License</a></p></footer></body></html>