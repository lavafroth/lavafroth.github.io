<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Some Assembly Required 3 - lavafroth</title><meta name=description content="This is a web exploitation challenge from 2021. It&rsquo;s pretty old but has less solves as of writing this post. I figured, it&rsquo;s worth talking about.
We are told to visit http://mercury.picoctf.net:60022/index.html where we find a simple textbox prompting us to submit the flag.
Looking at the page source by pressing ctrl u, we see that it is sourcing javascript code from rTEuOmSfG3.js.
<script src=&#34;rTEuOmSfG3.js&#34;></script> While examining the javascript, we will notice that it is obfuscated and packed."><meta name=author content="Himadri Bhattacharjee"><link rel="preload stylesheet" as=style href=https://lavafroth.is-a.dev/app.min.css><link rel=preload as=image href=https://lavafroth.is-a.dev/github.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/about.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/art.svg><link rel=icon href=https://lavafroth.is-a.dev/favicon.png><link rel=blog-icon href=https://lavafroth.is-a.dev/icon.png></head><body class=not-ready data-menu=true><header class=header><div class=lava><div class=logo><h1><a class=site-name href=https://lavafroth.is-a.dev/>lavafroth</a></h1><svg class="btn-dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 60 60" preserveAspectRatio="xMinYMin meet"><path class="circle" d="M30 16c7.73.0 14 6.27 14 14 0 3.81-1.53 7.27-4 9.8-2.54 2.59-6.08 4.2-10 4.2-7.73.0-14-6.27-14-14 0-7.73 6.27-14 14-14z"/><g class="rays" data-svg-origin="30 30"><line class="line" x1="30" y1="11" x2="30" y2="7"/><line class="line" x1="43.44" y1="16.57" x2="46.26" y2="13.74"/><line class="line" x1="49" y1="30" x2="53" y2="30"/><line class="line" x1="43.43" y1="43.44" x2="46.26" y2="46.26"/><line class="line" x1="30" y1="49" x2="30" y2="53"/><line class="line" x1="16.56" y1="43.43" x2="13.74" y2="46.26"/><line class="line" x1="11" y1="30" x2="7" y2="30"/><line class="line" x1="16.57" y1="16.56" x2="13.74" y2="13.74"/></g></svg><nav class=social><a class=github style=--url:url(./github.svg) href=https://github.com/lavafroth target=_blank></a>
<a href=../../about/ title style=--url:url(./about.svg)></a>
<a href=../../art/ title style=--url:url(./art.svg)></a></nav><script>const bodyClx=document.body.classList,btnDark=document.querySelector(".btn-dark"),sysDark=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark"),setDark=e=>(bodyClx.toggle("dark",e),localStorage.setItem("dark",e));setDark(darkVal==="true"||sysDark.matches),requestAnimationFrame(()=>bodyClx.remove("not-ready")),btnDark.addEventListener("click",()=>setDark(!bodyClx.contains("dark"))),sysDark.addEventListener("change",({matches:e})=>setDark(e))</script></div><div class=bubbles><div class=bubble style=--size:3.1573520635288297rem;--distance:9.777460616790547rem;--position:79.82351594640258%;--time:2.119561966408366s;--delay:-2.511069904370182s></div><div class=bubble style=--size:5.464382923434847rem;--distance:8.202204257500235rem;--position:73.05291394812365%;--time:2.8163650791714443s;--delay:-2.10834069552337s></div><div class=bubble style=--size:5.54171635032949rem;--distance:7.21628154079756rem;--position:3.5185273501097587%;--time:3.315974703485457s;--delay:-3.990557496815194s></div><div class=bubble style=--size:5.0780408722783115rem;--distance:7.9062882665654115rem;--position:96.75584737203708%;--time:2.9935278687454545s;--delay:-3.4097998510686813s></div><div class=bubble style=--size:2.451790257749897rem;--distance:9.375064105953562rem;--position:28.633085440410255%;--time:2.692548467667867s;--delay:-2.555074529650302s></div><div class=bubble style=--size:5.585816850593148rem;--distance:6.9600422960042865rem;--position:72.51244146669855%;--time:3.483246137208243s;--delay:-3.326136738066893s></div><div class=bubble style=--size:2.7392297893119135rem;--distance:8.030468953788962rem;--position:8.86445777813215%;--time:2.889575913936971s;--delay:-2.146827283616331s></div><div class=bubble style=--size:4.171962693508177rem;--distance:7.211002745280388rem;--position:58.2711084896879%;--time:2.716958408694885s;--delay:-3.296786648250234s></div><div class=bubble style=--size:4.532330684666543rem;--distance:8.578254049517938rem;--position:0.565927638475408%;--time:2.2846750146942254s;--delay:-3.4959322437591482s></div><div class=bubble style=--size:4.556463823827298rem;--distance:7.094090631014913rem;--position:70.39822723543791%;--time:3.624537503862896s;--delay:-2.857420933636443s></div><div class=bubble style=--size:5.07603378328206rem;--distance:6.645037412951618rem;--position:8.652005686621889%;--time:2.698244199090787s;--delay:-2.527616744094707s></div><div class=bubble style=--size:3.118201429900723rem;--distance:8.143294120584633rem;--position:64.35281134429346%;--time:2.2798669446425186s;--delay:-2.1420127307963344s></div><div class=bubble style=--size:3.418153008888427rem;--distance:9.064629817008509rem;--position:52.44283935234534%;--time:3.5827037199475575s;--delay:-2.995911643153717s></div><div class=bubble style=--size:2.191671240434883rem;--distance:8.944809822901478rem;--position:49.096851163552614%;--time:2.6651233627364372s;--delay:-3.300002230918009s></div><div class=bubble style=--size:3.369853326930267rem;--distance:6.331290194753575rem;--position:104.21704424457798%;--time:3.8955228568460027s;--delay:-3.4855417485078464s></div><div class=bubble style=--size:5.5113557063736245rem;--distance:8.568147573044554rem;--position:98.2498321096982%;--time:3.278666488584876s;--delay:-2.3468950982430616s></div><div class=bubble style=--size:5.672304818021649rem;--distance:9.782337765105405rem;--position:32.67241762023444%;--time:2.2703169650802293s;--delay:-3.9645713700523983s></div><div class=bubble style=--size:3.9388421289276483rem;--distance:7.218402286241155rem;--position:25.252599878511358%;--time:3.061152350442821s;--delay:-2.0708403071805406s></div><div class=bubble style=--size:2.206141240805235rem;--distance:7.760669925358866rem;--position:1.4597033545946854%;--time:3.969581249858505s;--delay:-2.2487091839080553s></div><div class=bubble style=--size:2.589806449494878rem;--distance:6.079178451528124rem;--position:56.42959891728088%;--time:2.9194662555481306s;--delay:-2.515893631902179s></div><div class=bubble style=--size:4.916044498049767rem;--distance:6.8458708795549095rem;--position:52.90949158878315%;--time:2.5752577719013083s;--delay:-3.6656718499279526s></div><div class=bubble style=--size:4.710265252521078rem;--distance:9.065982215990093rem;--position:62.232586785691396%;--time:3.63261593199919s;--delay:-2.0799296560779794s></div><div class=bubble style=--size:4.80868502150219rem;--distance:9.31843825728931rem;--position:52.33077257309814%;--time:3.1052043107141287s;--delay:-2.1829374129358485s></div><div class=bubble style=--size:4.60673963425293rem;--distance:8.84329033694339rem;--position:4.61870339863248%;--time:3.5258904404870326s;--delay:-3.7259085270061183s></div><div class=bubble style=--size:2.30776598310732rem;--distance:9.34563069282983rem;--position:86.81246243436092%;--time:3.3785018210778133s;--delay:-3.8884245347339097s></div><div class=bubble style=--size:3.771325201902952rem;--distance:7.537743036639792rem;--position:99.83782131571066%;--time:2.9795293630719635s;--delay:-2.0440255508279725s></div><div class=bubble style=--size:3.515905905101607rem;--distance:9.123800105025058rem;--position:52.27887455419%;--time:2.4743305426931745s;--delay:-2.1668790994717293s></div><div class=bubble style=--size:3.349975346700309rem;--distance:6.099525580933591rem;--position:86.19226178189942%;--time:3.73351241604457s;--delay:-3.7277466742109526s></div><div class=bubble style=--size:2.594203315627623rem;--distance:9.481507372000836rem;--position:48.478568433922725%;--time:2.001355560993734s;--delay:-2.873348731141025s></div><div class=bubble style=--size:4.208475535168454rem;--distance:7.949479398044607rem;--position:15.12817215146464%;--time:2.8775747141619057s;--delay:-2.44697699668547s></div><div class=bubble style=--size:4.808679093865685rem;--distance:8.35512071159537rem;--position:20.77592767701002%;--time:2.2941807591177183s;--delay:-2.0117738543581565s></div><div class=bubble style=--size:2.9094100558844787rem;--distance:8.658895286915223rem;--position:75.01431085194308%;--time:3.337416107927284s;--delay:-2.329229409935038s></div><div class=bubble style=--size:4.916550270723802rem;--distance:8.991371244178316rem;--position:88.16428124678242%;--time:3.543887527881868s;--delay:-3.117597716172686s></div><div class=bubble style=--size:4.183719518254308rem;--distance:6.036664021374489rem;--position:5.242327215616964%;--time:3.680410804784464s;--delay:-2.1979710698033066s></div><div class=bubble style=--size:2.195201281915745rem;--distance:7.54167483656756rem;--position:100.82583136288696%;--time:2.136409883934854s;--delay:-3.989942097610389s></div><div class=bubble style=--size:2.372472748316257rem;--distance:8.971269770130899rem;--position:35.22138774545767%;--time:3.504781994206962s;--delay:-3.569878419825069s></div><div class=bubble style=--size:4.1960151286835945rem;--distance:6.1215578387345095rem;--position:46.31269673675248%;--time:3.4151434354130674s;--delay:-2.387604702108186s></div><div class=bubble style=--size:2.196732774678229rem;--distance:8.804848936451702rem;--position:45.39987050964828%;--time:3.316683633487673s;--delay:-3.1981971902884685s></div><div class=bubble style=--size:2.0529976835521486rem;--distance:8.600957982798818rem;--position:41.37759553673493%;--time:3.2740925387984974s;--delay:-3.905976112047844s></div><div class=bubble style=--size:5.376914279513754rem;--distance:7.407085630853494rem;--position:63.24201611997715%;--time:2.1264285640291862s;--delay:-3.051025398511498s></div><div class=bubble style=--size:3.7450799812351994rem;--distance:9.27365599692357rem;--position:59.16835173165882%;--time:2.219333023219039s;--delay:-3.316382525233861s></div><div class=bubble style=--size:4.786605846571324rem;--distance:7.578229664193804rem;--position:60.6427424182681%;--time:2.8273438402809394s;--delay:-3.455732177447113s></div><div class=bubble style=--size:2.938278644808678rem;--distance:9.938293208055786rem;--position:76.67119791168354%;--time:2.103244616802722s;--delay:-3.9704952976762997s></div><div class=bubble style=--size:5.012613389182628rem;--distance:9.810547260738733rem;--position:19.822190366974635%;--time:2.0906950847679164s;--delay:-3.778541998909121s></div><div class=bubble style=--size:2.352723596034365rem;--distance:8.397253238309649rem;--position:-2.3316241256657855%;--time:3.518616763158588s;--delay:-2.7090310143181644s></div><div class=bubble style=--size:2.560757032134992rem;--distance:7.465288707793678rem;--position:59.52289816263949%;--time:2.3372893042504406s;--delay:-2.6207518451312732s></div><div class=bubble style=--size:5.764928617835869rem;--distance:7.038862224644299rem;--position:16.721242071278617%;--time:2.141182276317782s;--delay:-2.8786872186742465s></div><div class=bubble style=--size:5.822991651957761rem;--distance:8.095925336593208rem;--position:43.22787179511871%;--time:2.8490098963477255s;--delay:-2.7222347863832947s></div><div class=bubble style=--size:4.690866285770111rem;--distance:9.582968751042802rem;--position:9.034439977199735%;--time:3.1395412275822516s;--delay:-2.746787293711964s></div><div class=bubble style=--size:3.40545539505801rem;--distance:8.669729554506162rem;--position:-3.321193044421753%;--time:3.24881749500489s;--delay:-2.174245724907715s></div><div class=bubble style=--size:2.172294383071536rem;--distance:7.627910355839513rem;--position:92.16608231592369%;--time:2.047980200652401s;--delay:-3.862421045452209s></div><div class=bubble style=--size:2.425515628392274rem;--distance:7.609422479470836rem;--position:97.54851972848475%;--time:2.5336071978279824s;--delay:-2.9319860615603712s></div><div class=bubble style=--size:4.777143245059128rem;--distance:6.443914820662836rem;--position:90.52922244564954%;--time:3.3213063283891793s;--delay:-3.8505805988603834s></div><div class=bubble style=--size:3.072189810464895rem;--distance:7.263219342754864rem;--position:8.283420371048717%;--time:3.699352106176918s;--delay:-2.9613689746478737s></div><div class=bubble style=--size:4.228476129628428rem;--distance:6.36981004892698rem;--position:36.436296361102784%;--time:3.327948300393536s;--delay:-2.7019225510747096s></div><div class=bubble style=--size:4.745380579657766rem;--distance:6.655268131779713rem;--position:46.237833943953405%;--time:3.4810790747966522s;--delay:-3.440845596373659s></div><div class=bubble style=--size:2.492986251507652rem;--distance:8.850291761655484rem;--position:38.54527449053424%;--time:3.9459534084061887s;--delay:-3.2609494301905166s></div><div class=bubble style=--size:5.852520791787054rem;--distance:8.611646147069422rem;--position:-2.112337659082899%;--time:2.323082097601607s;--delay:-3.4305342668413266s></div><div class=bubble style=--size:4.712295628789016rem;--distance:7.608690016853551rem;--position:-0.70572452280945%;--time:2.5965373845022657s;--delay:-3.7992221451492902s></div><div class=bubble style=--size:2.9051516428147313rem;--distance:7.402827513210772rem;--position:23.977327965505314%;--time:3.9382729257289633s;--delay:-2.9478878399723887s></div><div class=bubble style=--size:5.37854688142705rem;--distance:8.550119881249136rem;--position:54.19156364567646%;--time:3.7770680873747033s;--delay:-3.5196870939784084s></div><div class=bubble style=--size:3.527712941562201rem;--distance:6.062329591706292rem;--position:-2.89796421492563%;--time:2.238022589528245s;--delay:-3.147375710595563s></div><div class=bubble style=--size:3.200640083274175rem;--distance:7.859513120786255rem;--position:13.747596391489125%;--time:3.387430173535349s;--delay:-2.508616413150541s></div><div class=bubble style=--size:2.163960447441803rem;--distance:8.778841962547915rem;--position:95.94500362059767%;--time:2.660417809838789s;--delay:-3.6130288690993306s></div><div class=bubble style=--size:3.156951339828767rem;--distance:9.956599461412498rem;--position:48.71783219463389%;--time:2.0794702862063223s;--delay:-3.998680242326202s></div><div class=bubble style=--size:3.7964213024842985rem;--distance:8.396204509710422rem;--position:72.59901296142988%;--time:2.7736924428434513s;--delay:-3.4193337878555097s></div><div class=bubble style=--size:5.15366941586544rem;--distance:7.442379170996494rem;--position:100.42443025305154%;--time:3.9160173799259588s;--delay:-2.5350633304517403s></div><div class=bubble style=--size:2.379578429213379rem;--distance:6.75740977433995rem;--position:6.071825202433391%;--time:2.7409259000987523s;--delay:-3.061518371851812s></div><div class=bubble style=--size:2.7161326200879365rem;--distance:7.443012696347425rem;--position:94.54154664489576%;--time:2.252009059953056s;--delay:-2.850428025421688s></div><div class=bubble style=--size:5.338213729194962rem;--distance:7.8296097748068245rem;--position:104.31815394727944%;--time:2.5181076015598363s;--delay:-2.792889558963517s></div><div class=bubble style=--size:4.677613519962753rem;--distance:7.547053659581501rem;--position:62.79503545575673%;--time:3.9798958335619075s;--delay:-2.642889547046062s></div><div class=bubble style=--size:4.600841539587519rem;--distance:7.111264085633966rem;--position:32.93333286860395%;--time:2.0995891279538843s;--delay:-2.82337099091355s></div><div class=bubble style=--size:4.937156614156352rem;--distance:8.141423872810948rem;--position:64.76377512989443%;--time:3.878011907641161s;--delay:-2.0776515861838476s></div><div class=bubble style=--size:5.464209147082656rem;--distance:6.16168015844219rem;--position:81.9093862477641%;--time:2.36096642742533s;--delay:-3.201129315223698s></div><div class=bubble style=--size:3.0638718374292786rem;--distance:8.339518681300468rem;--position:40.561492517815786%;--time:3.971239093589107s;--delay:-3.3289101684961806s></div><div class=bubble style=--size:3.7095814852639535rem;--distance:8.669471468140257rem;--position:34.09311265803539%;--time:2.430594868258288s;--delay:-3.287405916659933s></div><div class=bubble style=--size:2.9258659641866rem;--distance:8.87926442884251rem;--position:50.58373940219579%;--time:3.4807962221846354s;--delay:-3.59856198756007s></div><div class=bubble style=--size:2.066940049404841rem;--distance:8.748804284675305rem;--position:96.8971395843717%;--time:2.7453570642388048s;--delay:-3.0433424038921815s></div><div class=bubble style=--size:5.327630546150689rem;--distance:7.3836875147364625rem;--position:65.80986112208456%;--time:2.164964416386732s;--delay:-3.136378080242951s></div><div class=bubble style=--size:3.9306688638454874rem;--distance:9.944216015487171rem;--position:16.696802138049012%;--time:3.2471910283896617s;--delay:-2.798464726573834s></div><div class=bubble style=--size:2.0191221100891443rem;--distance:7.599369051527898rem;--position:68.0759833194086%;--time:3.78513125348422s;--delay:-2.731704015074298s></div><div class=bubble style=--size:4.709476032752907rem;--distance:8.592300096819226rem;--position:101.56836072747207%;--time:3.357821688195889s;--delay:-3.464741213898109s></div><div class=bubble style=--size:3.3015552870719986rem;--distance:8.186281390229443rem;--position:76.91449568684521%;--time:2.239942114775954s;--delay:-3.8058407969687678s></div><div class=bubble style=--size:2.3303913710914212rem;--distance:7.798936130721566rem;--position:17.863987177199412%;--time:2.569608702313029s;--delay:-2.6784270210611973s></div><div class=bubble style=--size:5.554787154774565rem;--distance:8.592136414160255rem;--position:89.18111414761651%;--time:2.8800003662802327s;--delay:-2.2567149506099313s></div><div class=bubble style=--size:2.874849035422754rem;--distance:9.102583798938209rem;--position:87.9256543749225%;--time:2.2168054627967226s;--delay:-3.805079017356886s></div><div class=bubble style=--size:4.472091382328382rem;--distance:9.004045355075995rem;--position:4.854675674342824%;--time:3.8531075079215604s;--delay:-2.79800835062909s></div><div class=bubble style=--size:3.5726260835226924rem;--distance:8.477994255893933rem;--position:72.46149584193786%;--time:3.979622326518513s;--delay:-2.061230017760451s></div><div class=bubble style=--size:4.163706989554627rem;--distance:9.47489849437773rem;--position:13.871782420024594%;--time:2.3515400527428927s;--delay:-2.0995962728471347s></div><div class=bubble style=--size:5.548356420073219rem;--distance:8.892675084107134rem;--position:46.11933460856142%;--time:3.545334586973909s;--delay:-3.3801543745894644s></div><div class=bubble style=--size:4.39219185055803rem;--distance:7.933095131117099rem;--position:47.221752007803346%;--time:2.366338056378407s;--delay:-2.4633871132846257s></div><div class=bubble style=--size:4.869873825638225rem;--distance:6.602238972606432rem;--position:8.008413506612953%;--time:2.2417693494331896s;--delay:-2.653305108946213s></div><div class=bubble style=--size:2.609803871778203rem;--distance:6.465015130775617rem;--position:98.45267853838197%;--time:3.2582634203691807s;--delay:-2.5469765884864146s></div><div class=bubble style=--size:3.692170879348117rem;--distance:6.148846216102932rem;--position:42.598683207916814%;--time:3.590027493217046s;--delay:-2.458627372938123s></div><div class=bubble style=--size:3.13371931340167rem;--distance:8.629774977369975rem;--position:8.26584091101138%;--time:3.4632516036299292s;--delay:-2.4428047213945976s></div><div class=bubble style=--size:5.3337351507338rem;--distance:9.514150167012112rem;--position:82.45272269713838%;--time:2.3798811696416964s;--delay:-2.7840053134258858s></div><div class=bubble style=--size:4.9046296721854405rem;--distance:8.604974499035588rem;--position:59.283370927934484%;--time:2.8248091589138493s;--delay:-3.5693285957321708s></div><div class=bubble style=--size:2.6672752126499217rem;--distance:8.387208213353594rem;--position:13.267155378078542%;--time:3.7363103446115558s;--delay:-2.910351872656129s></div><div class=bubble style=--size:2.2051971696247907rem;--distance:7.2819438794174625rem;--position:27.976116944859648%;--time:3.350821422712959s;--delay:-3.547854220935776s></div><div class=bubble style=--size:5.428924414714262rem;--distance:6.583819493754497rem;--position:99.8398036887203%;--time:2.4936663895530957s;--delay:-2.1438767599437383s></div><div class=bubble style=--size:2.0230413305356647rem;--distance:9.43453826170662rem;--position:12.213961398059165%;--time:3.0772160237064186s;--delay:-3.0795424392120987s></div><div class=bubble style=--size:2.063930526108078rem;--distance:9.558462346937564rem;--position:68.07796995584836%;--time:3.56929838791893s;--delay:-3.824027429996162s></div><div class=bubble style=--size:3.257099363627222rem;--distance:6.621327219169994rem;--position:92.33362842888727%;--time:2.0517956650841005s;--delay:-3.4422427087546907s></div><div class=bubble style=--size:2.1171301477954065rem;--distance:9.719096813129642rem;--position:70.08436689879504%;--time:3.7384308858183797s;--delay:-3.0706710752075197s></div><div class=bubble style=--size:5.112779410037207rem;--distance:7.695429389814016rem;--position:-2.14966602682227%;--time:3.57642299707581s;--delay:-2.4034192878360265s></div><div class=bubble style=--size:5.162675470130112rem;--distance:9.212118723148667rem;--position:3.0984197952934505%;--time:3.2589513048824457s;--delay:-2.5093381281915423s></div><div class=bubble style=--size:2.7246674568463787rem;--distance:9.12745268544741rem;--position:49.120294680111435%;--time:3.1762564511300977s;--delay:-3.832886220770901s></div><div class=bubble style=--size:5.349026043476247rem;--distance:8.790374067372515rem;--position:54.54843430655645%;--time:2.0700772264716036s;--delay:-3.975720761844946s></div><div class=bubble style=--size:5.127729051171082rem;--distance:6.142194386232878rem;--position:71.97016585088087%;--time:2.312705653014668s;--delay:-2.350598744844194s></div><div class=bubble style=--size:2.0201015578317145rem;--distance:9.75675051990936rem;--position:8.020062789238711%;--time:3.0732904442207842s;--delay:-3.4598954151773706s></div><div class=bubble style=--size:2.9164605310296974rem;--distance:8.41873984544106rem;--position:51.612260976605086%;--time:2.142616282498704s;--delay:-2.3847920007587478s></div><div class=bubble style=--size:3.5032717049186415rem;--distance:6.582979418765931rem;--position:-3.076434382195019%;--time:3.874670459658509s;--delay:-2.515671411117263s></div><div class=bubble style=--size:2.141933748277137rem;--distance:8.59581371621693rem;--position:33.93429226358781%;--time:3.6454031897063164s;--delay:-2.7940742798554132s></div><div class=bubble style=--size:3.345442714426433rem;--distance:9.044260951535312rem;--position:-4.650294346217494%;--time:2.0736419664755537s;--delay:-2.778792241654439s></div><div class=bubble style=--size:2.1263129168062553rem;--distance:7.3913517942503875rem;--position:31.45504027436062%;--time:2.4466944233932817s;--delay:-3.7532376177265623s></div><div class=bubble style=--size:5.241379779224864rem;--distance:6.259437679330544rem;--position:102.1413894444833%;--time:3.8907656928301555s;--delay:-3.3447980056450124s></div><div class=bubble style=--size:2.331998964957984rem;--distance:9.094390629027135rem;--position:-2.6908383211867837%;--time:2.8453745091133786s;--delay:-3.198027357641816s></div><div class=bubble style=--size:3.8204190766849466rem;--distance:6.442443820718948rem;--position:12.413067933385648%;--time:2.7830902741696306s;--delay:-3.1672753932191284s></div><div class=bubble style=--size:4.529982717229779rem;--distance:9.37007755632819rem;--position:100.37896472152282%;--time:2.569522003146849s;--delay:-2.2551840817951367s></div><div class=bubble style=--size:5.92838696231237rem;--distance:6.7301106256864545rem;--position:32.34812216630464%;--time:3.9023927560222624s;--delay:-2.255056982682299s></div><div class=bubble style=--size:4.699351072125338rem;--distance:6.766442174868489rem;--position:16.470785618032696%;--time:2.9972294563183746s;--delay:-2.3732040837342128s></div><div class=bubble style=--size:4.249420105641767rem;--distance:9.041961853600057rem;--position:38.606346517159736%;--time:2.373142369175816s;--delay:-2.6151599921478534s></div><div class=bubble style=--size:2.344663842468246rem;--distance:7.759965494391591rem;--position:65.474437910675%;--time:3.971142330142072s;--delay:-3.229227249606911s></div><div class=bubble style=--size:2.422280062220338rem;--distance:7.543330618328514rem;--position:81.87537876523214%;--time:2.3733202285494865s;--delay:-2.924996274989179s></div><div class=bubble style=--size:2.0125967736893333rem;--distance:9.770773664089738rem;--position:64.36956820131321%;--time:2.210066626569258s;--delay:-2.2942771000992472s></div><div class=bubble style=--size:4.566565802402101rem;--distance:6.704230153890237rem;--position:62.113076351236%;--time:2.5804502921480745s;--delay:-3.529413243520293s></div><div class=bubble style=--size:2.910533286234803rem;--distance:8.80350651389128rem;--position:59.47561542831464%;--time:3.433471577337245s;--delay:-3.491075664457081s></div><div class=bubble style=--size:2.5176134863940742rem;--distance:9.543890232600983rem;--position:2.633638418719375%;--time:3.9236323881961654s;--delay:-2.8545051911876764s></div><div class=lavasource></div></div><svg><defs><filter id="blob"><feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur"/><feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 19 -9" result="blob"/></filter></defs></svg></div></header><main class=main><article class=post-single><header class=post-title><p><time>Feb 9, 2023 | 7 minutes read</time></p><h1 data-pagefind-meta=title>Some Assembly Required 3</h1></header><section class=post-content data-pagefind-body><p>This is a web exploitation challenge from 2021. It&rsquo;s pretty old but
has less solves as of writing this post. I figured, it&rsquo;s worth talking
about.</p><p>We are told to visit
<a href=http://mercury.picoctf.net:60022/index.html>http://mercury.picoctf.net:60022/index.html</a>
where we find a simple textbox prompting us to submit the flag.</p><p>Looking at the page source by pressing <code>ctrl</code> <code>u</code>, we see that it is sourcing javascript code from <code>rTEuOmSfG3.js</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rTEuOmSfG3.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><p>While examining the javascript, we will notice that it is obfuscated and
packed. Put this through <a href=https://lelinhtinh.github.io/de4js/>de4js</a> to
prettify it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x143f</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;exports&#39;</span>, <span style=color:#e6db74>&#39;270328ewawLo&#39;</span>, <span style=color:#e6db74>&#39;instantiate&#39;</span>, <span style=color:#e6db74>&#39;1OsuamQ&#39;</span>, <span style=color:#e6db74>&#39;Incorrect!&#39;</span>, <span style=color:#e6db74>&#39;length&#39;</span>, <span style=color:#e6db74>&#39;copy_char&#39;</span>, <span style=color:#e6db74>&#39;value&#39;</span>, <span style=color:#e6db74>&#39;1512517ESezaM&#39;</span>, <span style=color:#e6db74>&#39;innerHTML&#39;</span>, <span style=color:#e6db74>&#39;check_flag&#39;</span>, <span style=color:#e6db74>&#39;result&#39;</span>, <span style=color:#e6db74>&#39;1383842SQRPPf&#39;</span>, <span style=color:#e6db74>&#39;924408cukzgO&#39;</span>, <span style=color:#e6db74>&#39;getElementById&#39;</span>, <span style=color:#e6db74>&#39;418508cLDohp&#39;</span>, <span style=color:#e6db74>&#39;input&#39;</span>, <span style=color:#e6db74>&#39;Correct!&#39;</span>, <span style=color:#e6db74>&#39;573XsMMHp&#39;</span>, <span style=color:#e6db74>&#39;arrayBuffer&#39;</span>, <span style=color:#e6db74>&#39;183RUQBDE&#39;</span>, <span style=color:#e6db74>&#39;38934oMACea&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x187e</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>_0x3075b9</span>, <span style=color:#a6e22e>_0x2ac888</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_0x3075b9</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x3075b9</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x11d</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x143f7d</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x143f</span>[<span style=color:#a6e22e>_0x3075b9</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>_0x143f7d</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>_0x3379df</span>, <span style=color:#a6e22e>_0x252604</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x1e2b12</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x187e</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (<span style=color:#f92672>!!</span>[]) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x5e2d0a</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x122</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x12f</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x126</span>)) <span style=color:#f92672>*</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x12b</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x132</span>)) <span style=color:#f92672>+</span> parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x124</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x121</span>)) <span style=color:#f92672>*</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x11f</span>)) <span style=color:#f92672>+</span> parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x130</span>));
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>_0x5e2d0a</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>_0x252604</span>) <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;push&#39;</span>](<span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;shift&#39;</span>]());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>_0x289152</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;push&#39;</span>](<span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;shift&#39;</span>]());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}(<span style=color:#a6e22e>_0x143f</span>, <span style=color:#ae81ff>0xed04c</span>));
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>exports</span>;
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x484ae0</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x187e</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x487b31</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;./qCCYI0ajpD&#39;</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>_0x5eebfd</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>WebAssembly</span>[<span style=color:#a6e22e>_0x484ae0</span>(<span style=color:#ae81ff>0x125</span>)](<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>_0x487b31</span>[<span style=color:#a6e22e>_0x484ae0</span>(<span style=color:#ae81ff>0x120</span>)]()),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>_0x30f3ed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x5eebfd</span>[<span style=color:#e6db74>&#39;instance&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x30f3ed</span>[<span style=color:#a6e22e>_0x484ae0</span>(<span style=color:#ae81ff>0x123</span>)];
</span></span><span style=display:flex><span>})();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>onButtonPress</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x271e58</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x187e</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x441124</span> <span style=color:#f92672>=</span> document[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x131</span>)](<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x11d</span>))[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x12a</span>)];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x34c54a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x0</span>; <span style=color:#a6e22e>_0x34c54a</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>_0x441124</span>[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x128</span>)]; <span style=color:#a6e22e>_0x34c54a</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>exports</span>[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x129</span>)](<span style=color:#a6e22e>_0x441124</span>[<span style=color:#e6db74>&#39;charCodeAt&#39;</span>](<span style=color:#a6e22e>_0x34c54a</span>), <span style=color:#a6e22e>_0x34c54a</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span>[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x129</span>)](<span style=color:#ae81ff>0x0</span>, <span style=color:#a6e22e>_0x441124</span>[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x128</span>)]), <span style=color:#a6e22e>exports</span>[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x12d</span>)]() <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x1</span> <span style=color:#f92672>?</span> document[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x131</span>)](<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x12e</span>))[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x12c</span>)] <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x11e</span>) <span style=color:#f92672>:</span> document[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x131</span>)](<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x12e</span>))[<span style=color:#e6db74>&#39;innerHTML&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x127</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We will save this to a file called <code>code.js</code>.</p><p>The first part is mutating, more specifically rotating, the definitions in
<code>_0x143f</code> until the sum of the integers sprinkled throughout the list equals
<code>0xed04c</code>. Take another look at the code to make sure you can verify why that
is the case.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x143f</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;exports&#39;</span>, <span style=color:#e6db74>&#39;270328ewawLo&#39;</span>, <span style=color:#e6db74>&#39;instantiate&#39;</span>, <span style=color:#e6db74>&#39;1OsuamQ&#39;</span>, <span style=color:#e6db74>&#39;Incorrect!&#39;</span>, <span style=color:#e6db74>&#39;length&#39;</span>, <span style=color:#e6db74>&#39;copy_char&#39;</span>, <span style=color:#e6db74>&#39;value&#39;</span>, <span style=color:#e6db74>&#39;1512517ESezaM&#39;</span>, <span style=color:#e6db74>&#39;innerHTML&#39;</span>, <span style=color:#e6db74>&#39;check_flag&#39;</span>, <span style=color:#e6db74>&#39;result&#39;</span>, <span style=color:#e6db74>&#39;1383842SQRPPf&#39;</span>, <span style=color:#e6db74>&#39;924408cukzgO&#39;</span>, <span style=color:#e6db74>&#39;getElementById&#39;</span>, <span style=color:#e6db74>&#39;418508cLDohp&#39;</span>, <span style=color:#e6db74>&#39;input&#39;</span>, <span style=color:#e6db74>&#39;Correct!&#39;</span>, <span style=color:#e6db74>&#39;573XsMMHp&#39;</span>, <span style=color:#e6db74>&#39;arrayBuffer&#39;</span>, <span style=color:#e6db74>&#39;183RUQBDE&#39;</span>, <span style=color:#e6db74>&#39;38934oMACea&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x187e</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>_0x3075b9</span>, <span style=color:#a6e22e>_0x2ac888</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_0x3075b9</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x3075b9</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x11d</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x143f7d</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x143f</span>[<span style=color:#a6e22e>_0x3075b9</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>_0x143f7d</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>_0x3379df</span>, <span style=color:#a6e22e>_0x252604</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x1e2b12</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x187e</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (<span style=color:#f92672>!!</span>[]) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x5e2d0a</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x122</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x12f</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x126</span>)) <span style=color:#f92672>*</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x12b</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x132</span>)) <span style=color:#f92672>+</span> parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x124</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x121</span>)) <span style=color:#f92672>*</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x11f</span>)) <span style=color:#f92672>+</span> parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x130</span>));
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>_0x5e2d0a</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>_0x252604</span>) <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;push&#39;</span>](<span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;shift&#39;</span>]());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>_0x289152</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;push&#39;</span>](<span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;shift&#39;</span>]());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}(<span style=color:#a6e22e>_0x143f</span>, <span style=color:#ae81ff>0xed04c</span>));
</span></span></code></pre></div><p>We can paste this into a <code>node</code> interactive <code>REPL</code> and get the final value of <code>_0x143f</code>.</p><pre tabindex=0><code>&gt; _0x143f
[
  &#39;input&#39;,          &#39;Correct!&#39;,
  &#39;573XsMMHp&#39;,      &#39;arrayBuffer&#39;,
  &#39;183RUQBDE&#39;,      &#39;38934oMACea&#39;,
  &#39;exports&#39;,        &#39;270328ewawLo&#39;,
  &#39;instantiate&#39;,    &#39;1OsuamQ&#39;,
  &#39;Incorrect!&#39;,     &#39;length&#39;,
  &#39;copy_char&#39;,      &#39;value&#39;,
  &#39;1512517ESezaM&#39;,  &#39;innerHTML&#39;,
  &#39;check_flag&#39;,     &#39;result&#39;,
  &#39;1383842SQRPPf&#39;,  &#39;924408cukzgO&#39;,
  &#39;getElementById&#39;, &#39;418508cLDohp&#39;
]
</code></pre><p>Notice the function <code>_0x187e</code> used indirectly to access elements of the
list. It is shadowed as <code>_0x271e58</code> and <code>_0x484ae0</code> to aid the obfuscation.
Other than that, the function is never called anywhere else. It makes sense
to evaluate the expressions from the function calls and then remove it.</p><p>Let&rsquo;s write a quick python script to do so.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> subprocess
</span></span><span style=display:flex><span>ex <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;_0x(271e58|484ae0)\((0x[123456789abcdef0]+)\)&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define the list and the indexing function</span>
</span></span><span style=display:flex><span>definitions <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>const _0x143f = [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;input&#39;,          &#39;Correct!&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;573XsMMHp&#39;,      &#39;arrayBuffer&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;183RUQBDE&#39;,      &#39;38934oMACea&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;exports&#39;,        &#39;270328ewawLo&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;instantiate&#39;,    &#39;1OsuamQ&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;Incorrect!&#39;,     &#39;length&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;copy_char&#39;,      &#39;value&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;1512517ESezaM&#39;,  &#39;innerHTML&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;check_flag&#39;,     &#39;result&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;1383842SQRPPf&#39;,  &#39;924408cukzgO&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;getElementById&#39;, &#39;418508cLDohp&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>];
</span></span></span><span style=display:flex><span><span style=color:#e6db74>const _0x187e = function (_0x3075b9, _0x2ac888) {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    _0x3075b9 = _0x3075b9 - 0x11d;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    let _0x143f7d = _0x143f[_0x3075b9];
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    return _0x143f7d;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;code.js&#39;</span>) <span style=color:#66d9ef>as</span> h:
</span></span><span style=display:flex><span>  contents <span style=color:#f92672>=</span> h<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>calls <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>log_calls <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> fn, call <span style=color:#f92672>in</span> ex<span style=color:#f92672>.</span>findall(contents):
</span></span><span style=display:flex><span>    shadow_call <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;_0x</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>(</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>)&#34;</span><span style=color:#f92672>.</span>format(fn, call)
</span></span><span style=display:flex><span>    calls<span style=color:#f92672>.</span>append(shadow_call)
</span></span><span style=display:flex><span>    log_calls<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#34;console.log(_0x187e(</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>))&#34;</span><span style=color:#f92672>.</span>format(call))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;code_1.js&#39;</span>, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> h:
</span></span><span style=display:flex><span>    h<span style=color:#f92672>.</span>write(definitions)
</span></span><span style=display:flex><span>    h<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>join(log_calls))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>evaluated <span style=color:#f92672>=</span> subprocess<span style=color:#f92672>.</span>check_output(<span style=color:#e6db74>&#34;node code_1.js&#34;</span>, shell<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>splitlines()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> call, expr <span style=color:#f92672>in</span> zip(calls, evaluated):
</span></span><span style=display:flex><span>    contents <span style=color:#f92672>=</span> contents<span style=color:#f92672>.</span>replace(call, <span style=color:#e6db74>&#39;&#34;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;&#39;</span><span style=color:#f92672>.</span>format(expr))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Ignore anything we have already evaluated,</span>
</span></span><span style=display:flex><span><span style=color:#75715e># in this case, anything before defining exports.</span>
</span></span><span style=display:flex><span>contents <span style=color:#f92672>=</span> contents[contents<span style=color:#f92672>.</span>index(<span style=color:#e6db74>&#34;let exports&#34;</span>):]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;code_1.js&#34;</span>, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> h:
</span></span><span style=display:flex><span>    h<span style=color:#f92672>.</span>write(contents)
</span></span></code></pre></div><p>We run the above code to get <code>code_1.js</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>exports</span>;
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x484ae0</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x187e</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x487b31</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;./qCCYI0ajpD&#39;</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>_0x5eebfd</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>WebAssembly</span>[<span style=color:#e6db74>&#34;instantiate&#34;</span>](<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>_0x487b31</span>[<span style=color:#e6db74>&#34;arrayBuffer&#34;</span>]()),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>_0x30f3ed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x5eebfd</span>[<span style=color:#e6db74>&#39;instance&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x30f3ed</span>[<span style=color:#e6db74>&#34;exports&#34;</span>];
</span></span><span style=display:flex><span>})();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>onButtonPress</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x271e58</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x187e</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x441124</span> <span style=color:#f92672>=</span> document[<span style=color:#e6db74>&#34;getElementById&#34;</span>](<span style=color:#e6db74>&#34;input&#34;</span>)[<span style=color:#e6db74>&#34;value&#34;</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x34c54a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x0</span>; <span style=color:#a6e22e>_0x34c54a</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>_0x441124</span>[<span style=color:#e6db74>&#34;length&#34;</span>]; <span style=color:#a6e22e>_0x34c54a</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>exports</span>[<span style=color:#e6db74>&#34;copy_char&#34;</span>](<span style=color:#a6e22e>_0x441124</span>[<span style=color:#e6db74>&#39;charCodeAt&#39;</span>](<span style=color:#a6e22e>_0x34c54a</span>), <span style=color:#a6e22e>_0x34c54a</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span>[<span style=color:#e6db74>&#34;copy_char&#34;</span>](<span style=color:#ae81ff>0x0</span>, <span style=color:#a6e22e>_0x441124</span>[<span style=color:#e6db74>&#34;length&#34;</span>]), <span style=color:#a6e22e>exports</span>[<span style=color:#e6db74>&#34;check_flag&#34;</span>]() <span style=color:#f92672>==</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>0x1</span> <span style=color:#f92672>?</span> document[<span style=color:#e6db74>&#34;getElementById&#34;</span>](<span style=color:#e6db74>&#34;result&#34;</span>)[<span style=color:#e6db74>&#34;innerHTML&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Correct!&#34;</span> <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    document[<span style=color:#e6db74>&#34;getElementById&#34;</span>](<span style=color:#e6db74>&#34;result&#34;</span>)[<span style=color:#e6db74>&#39;innerHTML&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Incorrect!&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We can interchange the object notations for function calls and array lengths.
After renaming some of the variables so that they make more sense, we end up
with the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>exports</span>;
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>blob</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;./qCCYI0ajpD&#39;</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>assembly</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>WebAssembly</span>.<span style=color:#a6e22e>instantiate</span>(<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>blob</span>.<span style=color:#a6e22e>arrayBuffer</span>()),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>instance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>assembly</span>[<span style=color:#e6db74>&#39;instance&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>instance</span>[<span style=color:#e6db74>&#34;exports&#34;</span>];
</span></span><span style=display:flex><span>})();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>onButtonPress</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;input&#34;</span>).<span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>copy_char</span>(<span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>charCodeAt</span>(<span style=color:#a6e22e>i</span>), <span style=color:#a6e22e>i</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>copy_char</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>length</span>), <span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>check_flag</span>() <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>    document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;result&#34;</span>).<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Correct!&#34;</span> <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;result&#34;</span>).<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Incorrect!&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The real magic happens when the script downloads a WebAssembly blob and uses
the functions exported in it to verify the input. Let&rsquo;s download the
WebAssembly file from the endpoint and decompile it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wget http://mercury.picoctf.net:60022/qCCYI0ajpD -O blob.wasm
</span></span><span style=display:flex><span>wasm-decompile blob.wasm -o decompiled.wat 
</span></span></code></pre></div><p>Among the functions defined, the <code>copy_char</code> function sticks out as it
appears to perform an <em>xor</em> with a key.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>copy</span>(<span style=color:#a6e22e>a</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>c</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>g_a</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>d</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>e</span><span style=color:#f92672>:</span><span style=color:#a6e22e>int_ptr</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>d</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>eqz</span>(<span style=color:#a6e22e>f</span>)) <span style=color:#66d9ef>goto</span> <span style=color:#a6e22e>B_a</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>g</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>h</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>j</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>h</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>i</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>k</span><span style=color:#f92672>:</span><span style=color:#a6e22e>ubyte_ptr</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>g</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>j</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>l</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>k</span>[<span style=color:#ae81ff>1067</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>m</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>24</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>n</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>l</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>o</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>n</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>p</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>q</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p</span> <span style=color:#f92672>^</span> <span style=color:#a6e22e>o</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>q</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>label</span> <span style=color:#a6e22e>B_a</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>r</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>s</span><span style=color:#f92672>:</span><span style=color:#a6e22e>byte_ptr</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>s</span>[<span style=color:#ae81ff>1072</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>r</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Looking through each line, we can simplify this quite a bit.</p><p>Here are some ways we can make educated guesses. From the code we see that <code>l</code>
is an integer.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>m</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>24</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>n</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>l</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>o</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>n</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>m</span>;
</span></span></code></pre></div><p>Subsequent left and right shifts by 24 means getting rid of the first <code>24 / 8 = 3</code> bytes. Here&rsquo;s an animation to visualize the process.</p><p><img src=../../lr-shifts.gif alt="Left and right shifts by 24"></p><p>This means <code>l</code> is actually used to index a byte and not an int.</p><blockquote><p>Note: The following code is not <code>wasm</code>, it&rsquo;s more akin to pseudocode.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>copy</span>(<span style=color:#a6e22e>a</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>e</span><span style=color:#f92672>:</span><span style=color:#a6e22e>int_ptr</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>g_a</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// if (eqz(e[3]:int)) goto B_a;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>*</span><span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// b[1072] = e[3];
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>b</span>[<span style=color:#ae81ff>1072</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>k</span><span style=color:#f92672>:</span><span style=color:#a6e22e>ubyte_ptr</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>-</span> (<span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>%</span> <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// var l:int = k[1067];
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// e[3] = e[3] ^ (l &lt;&lt; 24) &gt;&gt; 24;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>l</span><span style=color:#f92672>:</span><span style=color:#66d9ef>byte</span> <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>(<span style=color:#a6e22e>k</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1067</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>^</span> <span style=color:#a6e22e>l</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>From the beginning of the file, we can infer that some encoded string is
present at offset <code>1024</code>. Another shorter string starts from offset <code>1067</code>.</p><pre tabindex=0><code>data d_nAa1bd7(offset: 1024) =
  &#34;\9dn\93\c8\b2\b9A\8b\c5\c6\dda\93\c3\c2\da?\c7\93\c1\8b1\95\93\93\8eb\c8&#34;
  &#34;\94\c9\d5d\c0\96\c4\d97\93\93\c2\90\00\00&#34;;
data d_b(offset: 1067) = &#34;\f1\a7\f0\07\ed&#34;;
</code></pre><p>The following confirms that <code>k</code> indexes into the string at offset <code>1067</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>l</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>k</span>[<span style=color:#ae81ff>1067</span>];
</span></span></code></pre></div><p>Since <code>l</code> is used as the <em>xor</em> byte, the string at index <code>1067</code> must be the key.</p><p>The variable <code>k</code> rotates from <code>0</code> to <code>4</code> according to the index of the
character to decide the byte to <em>xor</em> with. <em>xor</em> is an involuntary function,
i.e., if something is <em>xor&rsquo;d</em> with a key twice, we get the original data back.
Therefore, we can undo the encoding.</p><p>We will create a Rust program to do this.</p><pre tabindex=0><code>cargo new picoctf
cargo add hex
</code></pre><p>Add the following code to <code>src/main.rs</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> hex;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> std::error::Error;
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() -&gt; Result<span style=color:#f92672>&lt;</span>(), Box<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>dyn</span> Error<span style=color:#f92672>&gt;&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> key <span style=color:#f92672>=</span> hex::decode(<span style=color:#e6db74>&#34;f1a7f007ed&#34;</span>)<span style=color:#f92672>?</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> crib: Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>u8</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> hex::decode(
</span></span><span style=display:flex><span>        <span style=color:#75715e>// &#34;\9dn\93\c8\b2\b9A\8b\c5\c6\dda\93\c3\c2\da?\c7\93\c1\8b1\95\93\93\8eb\c8&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#e6db74>&#34;9d6e93c8b2b9418bc5c6dd6193c3c2da3fc793c18b319593938e62c894c9d564c096c4d9379393c2900000&#34;</span>,
</span></span><span style=display:flex><span>    )<span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>    .into_iter()
</span></span><span style=display:flex><span>    .enumerate()
</span></span><span style=display:flex><span>    .map(<span style=color:#f92672>|</span>(i, x)<span style=color:#f92672>|</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>-</span> (i <span style=color:#f92672>%</span> <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> x <span style=color:#f92672>=</span> x <span style=color:#f92672>^</span> key[i];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> x <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> x <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0x7f</span> {
</span></span><span style=display:flex><span>            x
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    .collect();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> result <span style=color:#f92672>=</span> String::from_utf8(crib)<span style=color:#f92672>?</span>;
</span></span><span style=display:flex><span>    println!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{result}</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    Ok(())
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now we run the program.</p><pre tabindex=0><code>cargo run
</code></pre><pre tabindex=0><code>picoCTF{b70fcd378740f6e4bce8388c01540c43}
</code></pre><p>There we have our flag!</p></section></article><footer class=post-tags data-pagefind-meta=tags><a href=https://lavafroth.is-a.dev/tags/ctf>CTF</a>
<a href=https://lavafroth.is-a.dev/tags/picoctf>PicoCTF</a>
<a href=https://lavafroth.is-a.dev/tags/reverse-engineering>Reverse Engineering</a>
<a href=https://lavafroth.is-a.dev/tags/web>Web</a>
<a href=https://lavafroth.is-a.dev/tags/webassembly>WebAssembly</a></footer><nav class=post-nav><a class=prev href=https://lavafroth.is-a.dev/post/picoctf-web-java-script-kiddie-2/><span>←</span><span>Java Script Kiddie 2</span></a>
<a class=next href=https://lavafroth.is-a.dev/post/kringlecon-2022-writeup/><span>Kringlecon 2022 Writeup</span><span>→</span></a></nav></main><footer class=footer><p>&copy; 2023 <a href=https://lavafroth.is-a.dev/>lavafroth</a> | <a href=https://github.com/lavafroth/lavafroth.github.io/issues/new/choose>Report an issue</a> | <a href=https://github.com/lavafroth/lavafroth.github.io/discussions/>Discuss</a> | <a href=https://lavafroth.is-a.dev/privacy>Privacy</a></p></footer></body></html>