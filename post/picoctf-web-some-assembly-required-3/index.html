<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Some Assembly Required 3 - lavafroth</title><meta name=description content='This is a web exploitation challenge from 2021. It&rsquo;s pretty old but
has less solves as of writing this post. I figured, it&rsquo;s worth talking
about.
We are told to visit
http://mercury.picoctf.net:60022/index.html
where we find a simple textbox prompting us to submit the flag.
Looking at the page source by pressing ctrl u, we see that it is sourcing javascript code from rTEuOmSfG3.js.
<script src="rTEuOmSfG3.js"></script>
While examining the javascript, we will notice that it is obfuscated and
packed. Put this through de4js to
prettify it.'><meta name=author content><link rel="preload stylesheet" as=style href=https://lavafroth.is-a.dev/app.min.css><noscript><link rel="preload stylesheet" as=style href=https://lavafroth.is-a.dev/noscript.min.css></noscript><link rel=prefetch as=font href=https://lavafroth.is-a.dev/LeagueGothic.ttf><link as=font href=https://lavafroth.is-a.dev/latinmodern-math.otf><link rel=preload as=image href=https://lavafroth.is-a.dev/github.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/about.svg><link rel=preload as=image href=https://lavafroth.is-a.dev/art.svg><link rel=icon href=https://lavafroth.is-a.dev/favicon.png><link rel=blog-icon href=https://lavafroth.is-a.dev/icon.png></head><body class=not-ready data-menu=true><header class=header><h1><a class=site-name href=https://lavafroth.is-a.dev/>lavafroth</a></h1><svg class="btn-dark" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 60 60" preserveAspectRatio="xMinYMin meet"><path class="circle" d="M30 16c7.73.0 14 6.27 14 14 0 3.81-1.53 7.27-4 9.8-2.54 2.59-6.08 4.2-10 4.2-7.73.0-14-6.27-14-14 0-7.73 6.27-14 14-14z"/><g class="rays" data-svg-origin="30 30"><line class="line" x1="30" y1="11" x2="30" y2="7"/><line class="line" x1="43.44" y1="16.57" x2="46.26" y2="13.74"/><line class="line" x1="49" y1="30" x2="53" y2="30"/><line class="line" x1="43.43" y1="43.44" x2="46.26" y2="46.26"/><line class="line" x1="30" y1="49" x2="30" y2="53"/><line class="line" x1="16.56" y1="43.43" x2="13.74" y2="46.26"/><line class="line" x1="11" y1="30" x2="7" y2="30"/><line class="line" x1="16.57" y1="16.56" x2="13.74" y2="13.74"/></g></svg><div class=space></div><a style=--url:url(./github.svg) href=https://github.com/lavafroth aria-label=github target=_blank></a><a href=../../about/ aria-label=about style=--url:url(./about.svg)></a><a href=../../art/ aria-label=art style=--url:url(./art.svg)></a><script>const bodyClx=document.body.classList,btnDark=document.querySelector(".btn-dark"),sysDark=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark"),setDark=e=>(bodyClx.toggle("dark",e),localStorage.setItem("dark",e));setDark(darkVal?darkVal==="true":sysDark.matches),requestAnimationFrame(()=>bodyClx.remove("not-ready")),btnDark.addEventListener("click",()=>setDark(!bodyClx.contains("dark"))),sysDark.addEventListener("change",({matches:e})=>setDark(e))</script></header><main class=main><article class=post-single><header class=post-title><p><time>Feb 9, 2023 | 7 minutes read</time></p><h1 data-pagefind-meta=title>Some Assembly Required 3</h1></header><section class=post-content data-pagefind-body><p>This is a web exploitation challenge from 2021. It&rsquo;s pretty old but
has less solves as of writing this post. I figured, it&rsquo;s worth talking
about.</p><p>We are told to visit
<a href=http://mercury.picoctf.net:60022/index.html>http://mercury.picoctf.net:60022/index.html</a>
where we find a simple textbox prompting us to submit the flag.</p><p>Looking at the page source by pressing <code>ctrl</code> <code>u</code>, we see that it is sourcing javascript code from <code>rTEuOmSfG3.js</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rTEuOmSfG3.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><p>While examining the javascript, we will notice that it is obfuscated and
packed. Put this through <a href=https://lelinhtinh.github.io/de4js/>de4js</a> to
prettify it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x143f</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;exports&#39;</span>, <span style=color:#e6db74>&#39;270328ewawLo&#39;</span>, <span style=color:#e6db74>&#39;instantiate&#39;</span>, <span style=color:#e6db74>&#39;1OsuamQ&#39;</span>, <span style=color:#e6db74>&#39;Incorrect!&#39;</span>, <span style=color:#e6db74>&#39;length&#39;</span>, <span style=color:#e6db74>&#39;copy_char&#39;</span>, <span style=color:#e6db74>&#39;value&#39;</span>, <span style=color:#e6db74>&#39;1512517ESezaM&#39;</span>, <span style=color:#e6db74>&#39;innerHTML&#39;</span>, <span style=color:#e6db74>&#39;check_flag&#39;</span>, <span style=color:#e6db74>&#39;result&#39;</span>, <span style=color:#e6db74>&#39;1383842SQRPPf&#39;</span>, <span style=color:#e6db74>&#39;924408cukzgO&#39;</span>, <span style=color:#e6db74>&#39;getElementById&#39;</span>, <span style=color:#e6db74>&#39;418508cLDohp&#39;</span>, <span style=color:#e6db74>&#39;input&#39;</span>, <span style=color:#e6db74>&#39;Correct!&#39;</span>, <span style=color:#e6db74>&#39;573XsMMHp&#39;</span>, <span style=color:#e6db74>&#39;arrayBuffer&#39;</span>, <span style=color:#e6db74>&#39;183RUQBDE&#39;</span>, <span style=color:#e6db74>&#39;38934oMACea&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x187e</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>_0x3075b9</span>, <span style=color:#a6e22e>_0x2ac888</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_0x3075b9</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x3075b9</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x11d</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x143f7d</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x143f</span>[<span style=color:#a6e22e>_0x3075b9</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>_0x143f7d</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>_0x3379df</span>, <span style=color:#a6e22e>_0x252604</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x1e2b12</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x187e</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (<span style=color:#f92672>!!</span>[]) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x5e2d0a</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x122</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x12f</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x126</span>)) <span style=color:#f92672>*</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x12b</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x132</span>)) <span style=color:#f92672>+</span> parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x124</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x121</span>)) <span style=color:#f92672>*</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x11f</span>)) <span style=color:#f92672>+</span> parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x130</span>));
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>_0x5e2d0a</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>_0x252604</span>) <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;push&#39;</span>](<span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;shift&#39;</span>]());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>_0x289152</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;push&#39;</span>](<span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;shift&#39;</span>]());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}(<span style=color:#a6e22e>_0x143f</span>, <span style=color:#ae81ff>0xed04c</span>));
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>exports</span>;
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x484ae0</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x187e</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x487b31</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;./qCCYI0ajpD&#39;</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>_0x5eebfd</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>WebAssembly</span>[<span style=color:#a6e22e>_0x484ae0</span>(<span style=color:#ae81ff>0x125</span>)](<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>_0x487b31</span>[<span style=color:#a6e22e>_0x484ae0</span>(<span style=color:#ae81ff>0x120</span>)]()),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>_0x30f3ed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x5eebfd</span>[<span style=color:#e6db74>&#39;instance&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x30f3ed</span>[<span style=color:#a6e22e>_0x484ae0</span>(<span style=color:#ae81ff>0x123</span>)];
</span></span><span style=display:flex><span>})();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>onButtonPress</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x271e58</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x187e</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x441124</span> <span style=color:#f92672>=</span> document[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x131</span>)](<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x11d</span>))[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x12a</span>)];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x34c54a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x0</span>; <span style=color:#a6e22e>_0x34c54a</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>_0x441124</span>[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x128</span>)]; <span style=color:#a6e22e>_0x34c54a</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>exports</span>[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x129</span>)](<span style=color:#a6e22e>_0x441124</span>[<span style=color:#e6db74>&#39;charCodeAt&#39;</span>](<span style=color:#a6e22e>_0x34c54a</span>), <span style=color:#a6e22e>_0x34c54a</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span>[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x129</span>)](<span style=color:#ae81ff>0x0</span>, <span style=color:#a6e22e>_0x441124</span>[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x128</span>)]), <span style=color:#a6e22e>exports</span>[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x12d</span>)]() <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x1</span> <span style=color:#f92672>?</span> document[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x131</span>)](<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x12e</span>))[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x12c</span>)] <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x11e</span>) <span style=color:#f92672>:</span> document[<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x131</span>)](<span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x12e</span>))[<span style=color:#e6db74>&#39;innerHTML&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x271e58</span>(<span style=color:#ae81ff>0x127</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We will save this to a file called <code>code.js</code>.</p><p>The first part is mutating, more specifically rotating, the definitions in
<code>_0x143f</code> until the sum of the integers sprinkled throughout the list equals
<code>0xed04c</code>. Take another look at the code to make sure you can verify why that
is the case.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x143f</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;exports&#39;</span>, <span style=color:#e6db74>&#39;270328ewawLo&#39;</span>, <span style=color:#e6db74>&#39;instantiate&#39;</span>, <span style=color:#e6db74>&#39;1OsuamQ&#39;</span>, <span style=color:#e6db74>&#39;Incorrect!&#39;</span>, <span style=color:#e6db74>&#39;length&#39;</span>, <span style=color:#e6db74>&#39;copy_char&#39;</span>, <span style=color:#e6db74>&#39;value&#39;</span>, <span style=color:#e6db74>&#39;1512517ESezaM&#39;</span>, <span style=color:#e6db74>&#39;innerHTML&#39;</span>, <span style=color:#e6db74>&#39;check_flag&#39;</span>, <span style=color:#e6db74>&#39;result&#39;</span>, <span style=color:#e6db74>&#39;1383842SQRPPf&#39;</span>, <span style=color:#e6db74>&#39;924408cukzgO&#39;</span>, <span style=color:#e6db74>&#39;getElementById&#39;</span>, <span style=color:#e6db74>&#39;418508cLDohp&#39;</span>, <span style=color:#e6db74>&#39;input&#39;</span>, <span style=color:#e6db74>&#39;Correct!&#39;</span>, <span style=color:#e6db74>&#39;573XsMMHp&#39;</span>, <span style=color:#e6db74>&#39;arrayBuffer&#39;</span>, <span style=color:#e6db74>&#39;183RUQBDE&#39;</span>, <span style=color:#e6db74>&#39;38934oMACea&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x187e</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>_0x3075b9</span>, <span style=color:#a6e22e>_0x2ac888</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_0x3075b9</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x3075b9</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x11d</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x143f7d</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x143f</span>[<span style=color:#a6e22e>_0x3075b9</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>_0x143f7d</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>_0x3379df</span>, <span style=color:#a6e22e>_0x252604</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x1e2b12</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x187e</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (<span style=color:#f92672>!!</span>[]) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x5e2d0a</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x122</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x12f</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x126</span>)) <span style=color:#f92672>*</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x12b</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x132</span>)) <span style=color:#f92672>+</span> parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x124</span>)) <span style=color:#f92672>+</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x121</span>)) <span style=color:#f92672>*</span> <span style=color:#f92672>-</span>parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x11f</span>)) <span style=color:#f92672>+</span> parseInt(<span style=color:#a6e22e>_0x1e2b12</span>(<span style=color:#ae81ff>0x130</span>));
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>_0x5e2d0a</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>_0x252604</span>) <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;push&#39;</span>](<span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;shift&#39;</span>]());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>_0x289152</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;push&#39;</span>](<span style=color:#a6e22e>_0x3379df</span>[<span style=color:#e6db74>&#39;shift&#39;</span>]());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}(<span style=color:#a6e22e>_0x143f</span>, <span style=color:#ae81ff>0xed04c</span>));
</span></span></code></pre></div><p>We can paste this into a <code>node</code> interactive <code>REPL</code> and get the final value of <code>_0x143f</code>.</p><pre tabindex=0><code>&gt; _0x143f
[
  &#39;input&#39;,          &#39;Correct!&#39;,
  &#39;573XsMMHp&#39;,      &#39;arrayBuffer&#39;,
  &#39;183RUQBDE&#39;,      &#39;38934oMACea&#39;,
  &#39;exports&#39;,        &#39;270328ewawLo&#39;,
  &#39;instantiate&#39;,    &#39;1OsuamQ&#39;,
  &#39;Incorrect!&#39;,     &#39;length&#39;,
  &#39;copy_char&#39;,      &#39;value&#39;,
  &#39;1512517ESezaM&#39;,  &#39;innerHTML&#39;,
  &#39;check_flag&#39;,     &#39;result&#39;,
  &#39;1383842SQRPPf&#39;,  &#39;924408cukzgO&#39;,
  &#39;getElementById&#39;, &#39;418508cLDohp&#39;
]
</code></pre><p>Notice the function <code>_0x187e</code> used indirectly to access elements of the
list. It is shadowed as <code>_0x271e58</code> and <code>_0x484ae0</code> to aid the obfuscation.
Other than that, the function is never called anywhere else. It makes sense
to evaluate the expressions from the function calls and then remove it.</p><p>Let&rsquo;s write a quick python script to do so.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> subprocess
</span></span><span style=display:flex><span>ex <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;_0x(271e58|484ae0)\((0x[123456789abcdef0]+)\)&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define the list and the indexing function</span>
</span></span><span style=display:flex><span>definitions <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>const _0x143f = [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;input&#39;,          &#39;Correct!&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;573XsMMHp&#39;,      &#39;arrayBuffer&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;183RUQBDE&#39;,      &#39;38934oMACea&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;exports&#39;,        &#39;270328ewawLo&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;instantiate&#39;,    &#39;1OsuamQ&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;Incorrect!&#39;,     &#39;length&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;copy_char&#39;,      &#39;value&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;1512517ESezaM&#39;,  &#39;innerHTML&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;check_flag&#39;,     &#39;result&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;1383842SQRPPf&#39;,  &#39;924408cukzgO&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;getElementById&#39;, &#39;418508cLDohp&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>];
</span></span></span><span style=display:flex><span><span style=color:#e6db74>const _0x187e = function (_0x3075b9, _0x2ac888) {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    _0x3075b9 = _0x3075b9 - 0x11d;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    let _0x143f7d = _0x143f[_0x3075b9];
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    return _0x143f7d;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;code.js&#39;</span>) <span style=color:#66d9ef>as</span> h:
</span></span><span style=display:flex><span>  contents <span style=color:#f92672>=</span> h<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>calls <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>log_calls <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> fn, call <span style=color:#f92672>in</span> ex<span style=color:#f92672>.</span>findall(contents):
</span></span><span style=display:flex><span>    shadow_call <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;_0x</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>(</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>)&#34;</span><span style=color:#f92672>.</span>format(fn, call)
</span></span><span style=display:flex><span>    calls<span style=color:#f92672>.</span>append(shadow_call)
</span></span><span style=display:flex><span>    log_calls<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#34;console.log(_0x187e(</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>))&#34;</span><span style=color:#f92672>.</span>format(call))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;code_1.js&#39;</span>, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> h:
</span></span><span style=display:flex><span>    h<span style=color:#f92672>.</span>write(definitions)
</span></span><span style=display:flex><span>    h<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>join(log_calls))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>evaluated <span style=color:#f92672>=</span> subprocess<span style=color:#f92672>.</span>check_output(<span style=color:#e6db74>&#34;node code_1.js&#34;</span>, shell<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>splitlines()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> call, expr <span style=color:#f92672>in</span> zip(calls, evaluated):
</span></span><span style=display:flex><span>    contents <span style=color:#f92672>=</span> contents<span style=color:#f92672>.</span>replace(call, <span style=color:#e6db74>&#39;&#34;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;&#39;</span><span style=color:#f92672>.</span>format(expr))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Ignore anything we have already evaluated,</span>
</span></span><span style=display:flex><span><span style=color:#75715e># in this case, anything before defining exports.</span>
</span></span><span style=display:flex><span>contents <span style=color:#f92672>=</span> contents[contents<span style=color:#f92672>.</span>index(<span style=color:#e6db74>&#34;let exports&#34;</span>):]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;code_1.js&#34;</span>, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> h:
</span></span><span style=display:flex><span>    h<span style=color:#f92672>.</span>write(contents)
</span></span></code></pre></div><p>We run the above code to get <code>code_1.js</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>exports</span>;
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x484ae0</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x187e</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x487b31</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;./qCCYI0ajpD&#39;</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>_0x5eebfd</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>WebAssembly</span>[<span style=color:#e6db74>&#34;instantiate&#34;</span>](<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>_0x487b31</span>[<span style=color:#e6db74>&#34;arrayBuffer&#34;</span>]()),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>_0x30f3ed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x5eebfd</span>[<span style=color:#e6db74>&#39;instance&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x30f3ed</span>[<span style=color:#e6db74>&#34;exports&#34;</span>];
</span></span><span style=display:flex><span>})();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>onButtonPress</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_0x271e58</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_0x187e</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x441124</span> <span style=color:#f92672>=</span> document[<span style=color:#e6db74>&#34;getElementById&#34;</span>](<span style=color:#e6db74>&#34;input&#34;</span>)[<span style=color:#e6db74>&#34;value&#34;</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>_0x34c54a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x0</span>; <span style=color:#a6e22e>_0x34c54a</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>_0x441124</span>[<span style=color:#e6db74>&#34;length&#34;</span>]; <span style=color:#a6e22e>_0x34c54a</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>exports</span>[<span style=color:#e6db74>&#34;copy_char&#34;</span>](<span style=color:#a6e22e>_0x441124</span>[<span style=color:#e6db74>&#39;charCodeAt&#39;</span>](<span style=color:#a6e22e>_0x34c54a</span>), <span style=color:#a6e22e>_0x34c54a</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span>[<span style=color:#e6db74>&#34;copy_char&#34;</span>](<span style=color:#ae81ff>0x0</span>, <span style=color:#a6e22e>_0x441124</span>[<span style=color:#e6db74>&#34;length&#34;</span>]), <span style=color:#a6e22e>exports</span>[<span style=color:#e6db74>&#34;check_flag&#34;</span>]() <span style=color:#f92672>==</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>0x1</span> <span style=color:#f92672>?</span> document[<span style=color:#e6db74>&#34;getElementById&#34;</span>](<span style=color:#e6db74>&#34;result&#34;</span>)[<span style=color:#e6db74>&#34;innerHTML&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Correct!&#34;</span> <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    document[<span style=color:#e6db74>&#34;getElementById&#34;</span>](<span style=color:#e6db74>&#34;result&#34;</span>)[<span style=color:#e6db74>&#39;innerHTML&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Incorrect!&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We can interchange the object notations for function calls and array lengths.
After renaming some of the variables so that they make more sense, we end up
with the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>exports</span>;
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>blob</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;./qCCYI0ajpD&#39;</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>assembly</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>WebAssembly</span>.<span style=color:#a6e22e>instantiate</span>(<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>blob</span>.<span style=color:#a6e22e>arrayBuffer</span>()),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>instance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>assembly</span>[<span style=color:#e6db74>&#39;instance&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>instance</span>[<span style=color:#e6db74>&#34;exports&#34;</span>];
</span></span><span style=display:flex><span>})();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>onButtonPress</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;input&#34;</span>).<span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>copy_char</span>(<span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>charCodeAt</span>(<span style=color:#a6e22e>i</span>), <span style=color:#a6e22e>i</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>copy_char</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>length</span>), <span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>check_flag</span>() <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>    document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;result&#34;</span>).<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Correct!&#34;</span> <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;result&#34;</span>).<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Incorrect!&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The real magic happens when the script downloads a WebAssembly blob and uses
the functions exported in it to verify the input. Let&rsquo;s download the
WebAssembly file from the endpoint and decompile it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wget http://mercury.picoctf.net:60022/qCCYI0ajpD -O blob.wasm
</span></span><span style=display:flex><span>wasm-decompile blob.wasm -o decompiled.wat 
</span></span></code></pre></div><p>Among the functions defined, the <code>copy_char</code> function sticks out as it
appears to perform an <em>xor</em> with a key.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>copy</span>(<span style=color:#a6e22e>a</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>c</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>g_a</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>d</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>e</span><span style=color:#f92672>:</span><span style=color:#a6e22e>int_ptr</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>d</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>eqz</span>(<span style=color:#a6e22e>f</span>)) <span style=color:#66d9ef>goto</span> <span style=color:#a6e22e>B_a</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>g</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>h</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>j</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>h</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>i</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>k</span><span style=color:#f92672>:</span><span style=color:#a6e22e>ubyte_ptr</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>g</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>j</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>l</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>k</span>[<span style=color:#ae81ff>1067</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>m</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>24</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>n</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>l</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>o</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>n</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>p</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>q</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p</span> <span style=color:#f92672>^</span> <span style=color:#a6e22e>o</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>q</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>label</span> <span style=color:#a6e22e>B_a</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>r</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>s</span><span style=color:#f92672>:</span><span style=color:#a6e22e>byte_ptr</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>s</span>[<span style=color:#ae81ff>1072</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>r</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Looking through each line, we can simplify this quite a bit.</p><p>Here are some ways we can make educated guesses. From the code we see that <code>l</code>
is an integer.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>m</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>24</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>n</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>l</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>o</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>n</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>m</span>;
</span></span></code></pre></div><p>Subsequent left and right shifts by 24 means getting rid of the first <code>24 / 8 = 3</code> bytes. Here&rsquo;s an animation to visualize the process.</p><p><img src=../../lr-shifts.gif alt="Left and right shifts by 24"></p><p>This means <code>l</code> is actually used to index a byte and not an int.</p><blockquote><p>Note: The following code is not <code>wasm</code>, it&rsquo;s more akin to pseudocode.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>copy</span>(<span style=color:#a6e22e>a</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>e</span><span style=color:#f92672>:</span><span style=color:#a6e22e>int_ptr</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>g_a</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// if (eqz(e[3]:int)) goto B_a;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>*</span><span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// b[1072] = e[3];
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>b</span>[<span style=color:#ae81ff>1072</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>k</span><span style=color:#f92672>:</span><span style=color:#a6e22e>ubyte_ptr</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>-</span> (<span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>%</span> <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// var l:int = k[1067];
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// e[3] = e[3] ^ (l &lt;&lt; 24) &gt;&gt; 24;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>l</span><span style=color:#f92672>:</span><span style=color:#66d9ef>byte</span> <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>(<span style=color:#a6e22e>k</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1067</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>^</span> <span style=color:#a6e22e>l</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>From the beginning of the file, we can infer that some encoded string is
present at offset <code>1024</code>. Another shorter string starts from offset <code>1067</code>.</p><pre tabindex=0><code>data d_nAa1bd7(offset: 1024) =
  &#34;\9dn\93\c8\b2\b9A\8b\c5\c6\dda\93\c3\c2\da?\c7\93\c1\8b1\95\93\93\8eb\c8&#34;
  &#34;\94\c9\d5d\c0\96\c4\d97\93\93\c2\90\00\00&#34;;
data d_b(offset: 1067) = &#34;\f1\a7\f0\07\ed&#34;;
</code></pre><p>The following confirms that <code>k</code> indexes into the string at offset <code>1067</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>l</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>k</span>[<span style=color:#ae81ff>1067</span>];
</span></span></code></pre></div><p>Since <code>l</code> is used as the <em>xor</em> byte, the string at index <code>1067</code> must be the key.</p><p>The variable <code>k</code> rotates from <code>0</code> to <code>4</code> according to the index of the
character to decide the byte to <em>xor</em> with. <em>xor</em> is an involuntary function,
i.e., if something is <em>xor&rsquo;d</em> with a key twice, we get the original data back.
Therefore, we can undo the encoding.</p><p>We will create a Rust program to do this.</p><pre tabindex=0><code>cargo new picoctf
cargo add hex
</code></pre><p>Add the following code to <code>src/main.rs</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> hex;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> std::error::Error;
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() -&gt; Result<span style=color:#f92672>&lt;</span>(), Box<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>dyn</span> Error<span style=color:#f92672>&gt;&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> key <span style=color:#f92672>=</span> hex::decode(<span style=color:#e6db74>&#34;f1a7f007ed&#34;</span>)<span style=color:#f92672>?</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> crib: Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>u8</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> hex::decode(
</span></span><span style=display:flex><span>        <span style=color:#75715e>// &#34;\9dn\93\c8\b2\b9A\8b\c5\c6\dda\93\c3\c2\da?\c7\93\c1\8b1\95\93\93\8eb\c8&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#e6db74>&#34;9d6e93c8b2b9418bc5c6dd6193c3c2da3fc793c18b319593938e62c894c9d564c096c4d9379393c2900000&#34;</span>,
</span></span><span style=display:flex><span>    )<span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>    .into_iter()
</span></span><span style=display:flex><span>    .enumerate()
</span></span><span style=display:flex><span>    .map(<span style=color:#f92672>|</span>(i, x)<span style=color:#f92672>|</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>-</span> (i <span style=color:#f92672>%</span> <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> x <span style=color:#f92672>=</span> x <span style=color:#f92672>^</span> key[i];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> x <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> x <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0x7f</span> {
</span></span><span style=display:flex><span>            x
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    .collect();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> result <span style=color:#f92672>=</span> String::from_utf8(crib)<span style=color:#f92672>?</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{result}</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    Ok(())
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now we run the program.</p><pre tabindex=0><code>cargo run
</code></pre><pre tabindex=0><code>picoCTF{b70fcd378740f6e4bce8388c01540c43}
</code></pre><p>There we have our flag!</p></section></article><footer class=post-tags data-pagefind-meta=tags><a href=https://lavafroth.is-a.dev/tags/ctf class=list-tag>CTF</a>
<a href=https://lavafroth.is-a.dev/tags/picoctf class=list-tag>PicoCTF</a>
<a href=https://lavafroth.is-a.dev/tags/reverse-engineering class=list-tag>Reverse Engineering</a>
<a href=https://lavafroth.is-a.dev/tags/web class=list-tag>Web</a>
<a href=https://lavafroth.is-a.dev/tags/webassembly class=list-tag>WebAssembly</a></footer><nav class=post-nav><a class=prev href=https://lavafroth.is-a.dev/post/picoctf-web-java-script-kiddie-2/><span>←</span><span>Java Script Kiddie 2</span></a>
<a class=next href=https://lavafroth.is-a.dev/post/kringlecon-2022-writeup/><span>Kringlecon 2022 Writeup</span><span>→</span></a></nav></main><footer class=footer><p>&copy; 2025 <a href=https://lavafroth.is-a.dev/>lavafroth</a></p><p><a href=https://github.com/lavafroth/lavafroth.github.io/issues/new/choose>Report an issue</a></p><p><a href=https://github.com/lavafroth/lavafroth.github.io/discussions/>Discuss</a></p><p><a href=https://lavafroth.is-a.dev/privacy>Privacy</a></p><p><a href=https://creativecommons.org/licenses/by-sa/4.0/legalcode>License</a></p></footer></body></html>